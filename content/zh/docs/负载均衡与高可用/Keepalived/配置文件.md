---
title: "配置文件"
---

# 配置文件结构

- **global_defs：全局配置**
  - 定义邮件配置、route_id、vrrp配置、多播地址等
- **vrrp_instance：虚拟路由配置**
  - 定义每个vrrp虚拟路由器
- **virtual_server：虚拟服务器配置**
  - LVS集群的VS和RS





# 虚拟路由器配置

- 可以配置多组此字段，针对不同业务 如：web、mysql、redis等

```bash
# /etc/keepalived/keepalived.conf
...
vrrp_instance <STRING> { #<STRING>为vrrp的实例名，一般为业务名称
    state MASTER #当前节点在此虚拟路由器上的初始状态，状态为MASTER或BACKUP，不是配置master就为master，是否是master取决于priority的值是否在路由器组中最高
    interface eth0 #绑定为当前虚拟路由器使用的物理接口，如eth0...，可以和VIP不在一个网卡
    
    virtual_router_id 51 #每个虚拟路由器组的唯一标识，范围：0-255，同属一个虚拟路由器组的多个keepalived节点此值必须相同，与其他虚拟路由器组的此值不能相同，否则服务无法启动
    
    priority 100 #优先级，范围：1-254，数值越大越优先，每个keepalived主机节点此值不同
    advert_int 1 #vrrp通告的时间间隔，默认1s
    
    authentication { #认证机制
        auth_type PASS #PASS为简单密码，也可以设置为AH 表示IPESC认证(不推荐)
        auth_pass 111 #密码，仅前8位有效,同属一个虚拟路由器组的多个keepalived节点此值必须相同
    }
    virtual_ipaddress { #虚拟ip地址，生产环境中可能指定上百个IP地址
        192.168.200.16 #指定VIP，不指定网卡则默认为eth0，不指定/postfix则默认为/32
        192.168.200.17/24 dev eth0 #指定子网掩码和网卡
        192.168.200.18/16 dev eth2 label eth2:1 #指定VIP网卡的label
    }
    
    tarck_interface { #配置监控网络接口，一旦出现故障，则转为FAULT状态实现地址转移
        eth0
        eth1
        ....
    }
}
```



# 实现独立子配置文件

```bash
[root@centos8 ~]#vim /etc/keepalived/keepalived.conf
global_defs {
...
}
include /etc/keepalived/conf.d/*.conf #添加此行，将VRRP相关配置放在子配置文件中
```

