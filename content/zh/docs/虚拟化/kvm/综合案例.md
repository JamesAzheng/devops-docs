---
title: "综合案例"
---

# KVM宿主机连接共享存储实现虚拟机实时迁移

- 下面以NFS作为演示，生产中可能使用NAS等设备

## 环境说明

| Hostname    | IP         |      |      |      |
| ----------- | ---------- | ---- | ---- | ---- |
| nfs-server  | 10.0.0.100 |      |      |      |
| centos-kvm1 | 10.0.0.18  |      |      |      |
| centos-kvm2 | 10.0.0.28  |      |      |      |

## 注意事项

- kvm宿主机中的虚拟机网卡配置必须一样，并且都桥接到如：virbr1的自定义网桥中
- 要迁移的虚拟机必须是运行状态才可迁移
- 如**宿主机**版本不同建议从低版本往高版本迁移，如：centos7宿主机的虚拟机迁移至centos8宿主机上，反之可能会迁移失败

## nfs-server 配置

### 安装nfs

```bash
#centos
yum -y install nfs-utils

#ubuntu
apt -y install nfs-kernel-server
```

### 配置共享目录

```bash
#创建用于共享的目录
mkdir -p /data/kvmdata

#修改配置文件以实现共享
# vim /etc/exports
/data/kvmdata *(rw,no_root_squash)
```

### 启动nfs

```bash
systemctl enable --now nfs-server.service
```



## centos-kvm1 配置

...

## centos-kvm2 配置

...

