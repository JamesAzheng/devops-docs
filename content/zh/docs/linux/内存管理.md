---
title: "å†…å­˜ç®¡ç†"
---

## Swap
swapå¯ä»¥é¿å…åº”ç”¨ç¨‹åºå› å†…å­˜ä¸è¶³è€Œå´©æºƒï¼Œä½†å®ƒçš„æ€§èƒ½è¿œä¸åŠå†…å­˜ï¼Œé€‚ç”¨äºç‰¹æ®Šåœºæ™¯ï¼ˆä¾‹å¦‚æˆ‘çš„ecsåªæœ‰2Gå†…å­˜ğŸ˜…ï¼‰ã€‚å®ç°æ–¹å¼å¯ä»¥åŸºäºäº¤æ¢æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åŸºäºç£ç›˜åˆ†åŒºï¼Œå¹¶ä¸”å†…æ ¸å‚æ•°`vm.swappiness`å¯ä»¥å®šä¹‰swapä¸å†…å­˜çš„ä½¿ç”¨å æ¯”ï¼Œå³ä¼˜å…ˆä½¿ç”¨å†…å­˜è¿˜æ˜¯swapã€‚

---

### åˆ›å»ºä¸€ä¸ªäº¤æ¢æ–‡ä»¶ä½œä¸ºSwap
```bash
# åˆ›å»ºä¸€ä¸ªäº¤æ¢æ–‡ä»¶ä½œä¸ºSwap
dd if=/dev/zero of=/swapfile bs=1M count=4096

# è®¾ç½®åˆé€‚çš„æƒé™
chmod 600 /swapfile

# å°†æ–‡ä»¶æ ¼å¼åŒ–ä¸ºswapç©ºé—´
mkswap /swapfile

# å¯ç”¨swapæ–‡ä»¶
swapon /swapfile

# æŒä¹…åŒ–
echo '/swapfile none swap sw 0 0' >> /etc/fstab

# æ£€æŸ¥Swapæ˜¯å¦å·²å¯ç”¨
free -h
swapon --show
```


### ä½¿ç”¨ç£ç›˜åˆ†åŒºä½œä¸ºSwap
å¦‚æœä½ æƒ³å°†æ•´ä¸ªç£ç›˜åˆ†åŒºä½œä¸ºswapï¼Œè€Œä¸æ˜¯ä½¿ç”¨äº¤æ¢æ–‡ä»¶ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š
1. **åˆ›å»ºswapåˆ†åŒº**ï¼ˆå¯ä»¥ä½¿ç”¨`fdisk`æˆ–`parted`å·¥å…·ï¼‰ï¼š

- ä½¿ç”¨`fdisk`åˆ›å»ºä¸€ä¸ªæ–°çš„Linux swapåˆ†åŒºï¼Œé€šå¸¸é€‰æ‹©ç±»å‹ä¸º`82`ï¼ˆLinux swapï¼‰ã€‚
2. **æ ¼å¼åŒ–è¯¥åˆ†åŒºä¸ºswapæ ¼å¼**ï¼š

```bash
sudo mkswap /dev/sdXn  # æ›¿æ¢ /dev/sdXn ä¸ºä½ åˆšåˆšåˆ›å»ºçš„åˆ†åŒº

```
3. **å¯ç”¨swapåˆ†åŒº**ï¼š

```bash
sudo swapon /dev/sdXn

```
4. **ç¡®ä¿åˆ†åŒºåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨**ï¼š
ä¿®æ”¹`/etc/fstab`æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```bash
/dev/sdXn none swap sw 0 0

```

### Swapç›¸å…³å†…æ ¸å‚æ•°
`vm.swappiness`æ˜¯Linuxå†…æ ¸ä¸­ç”¨æ¥æ§åˆ¶äº¤æ¢çš„è¡Œä¸ºçš„å‚æ•°ã€‚å®ƒçš„å€¼å†³å®šäº†å†…å­˜æ»¡æ—¶äº¤æ¢çš„ä¼˜å…ˆçº§ã€‚å€¼çš„èŒƒå›´æ˜¯`0`åˆ°`100`ï¼Œ`0`è¡¨ç¤ºå†…å­˜å‡ ä¹ç”¨å®Œä¹‹å‰ä¸ä¼šäº¤æ¢ï¼Œ`100`è¡¨ç¤ºå†…å­˜ç¨å¾®ç´§å¼ æ—¶å°±ä¼šä½¿ç”¨swapã€‚

æŸ¥çœ‹å½“å‰`swappiness`å€¼ï¼š
```bash
cat /proc/sys/vm/swappiness

```

ä¸´æ—¶è°ƒæ•´`swappiness`ï¼š
```bash
sudo sysctl vm.swappiness=30  # è®¾ç½®ä¸º30ï¼Œé™ä½äº¤æ¢çš„é¢‘ç‡

```

æ°¸ä¹…æ›´æ”¹`swappiness`ï¼š
ç¼–è¾‘`/etc/sysctl.conf`æ–‡ä»¶ï¼ŒåŠ å…¥ï¼š
```bash
vm.swappiness=30

```

ç„¶åæ‰§è¡Œï¼š
```bash
sudo sysctl -p

```


## ---

# buffer

- Buffers æ˜¯å†…æ ¸ç¼“å†²åŒºç”¨åˆ°çš„å†…å­˜

  - å¯¹åº”çš„æ˜¯ /proc/meminfo ä¸­çš„ Buffers å€¼ã€‚

  - ```bash
    # cat /proc/meminfo 
    ...
    Buffers:            2104 kB 
    ...
    ```

- Buffers æ˜¯å¯¹åŸå§‹ç£ç›˜å—çš„ä¸´æ—¶å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥**ç¼“å­˜ç£ç›˜çš„æ•°æ®**ï¼Œé€šå¸¸ä¸ä¼šç‰¹åˆ«å¤§ï¼ˆ20MB å·¦å³ï¼‰ã€‚è¿™æ ·ï¼Œå†…æ ¸å°±å¯ä»¥æŠŠåˆ†æ•£çš„å†™é›†ä¸­èµ·æ¥ï¼Œç»Ÿä¸€ä¼˜åŒ–ç£ç›˜çš„å†™å…¥ï¼Œæ¯”å¦‚å¯ä»¥æŠŠå¤šæ¬¡å°çš„å†™åˆå¹¶æˆå•æ¬¡å¤§çš„å†™ç­‰ç­‰ã€‚åˆå¹¶è¿™é‡Œä¼¼ä¹å’Œå¤§æ•°æ®ç”Ÿæ€ä¸­çš„Hadoopç»„ä»¶ä¸­çš„å°æ–‡ä»¶åˆå¹¶æœ‰ç›¸ä¼¼ã€‚

- ç¼“å†²åŒºï¼Œæ•°æ®å†™å…¥ç£ç›˜å‰æš‚æ—¶å­˜æ”¾çš„ç©ºé—´



# cache

- Cache æ˜¯å†…æ ¸é¡µç¼“å­˜å’Œ Slab ç”¨åˆ°çš„å†…å­˜

  - å¯¹åº”çš„æ˜¯ /proc/meminfo ä¸­çš„ Cached ä¸ SReclaimable ä¹‹å’Œã€‚

  - ```bash
    # cat /proc/meminfo |grep SReclaimable
    ...
    Cached:          1079152 kB
    ...
    SReclaimable:     125492 kB
    ...
    ```

- Cached æ˜¯ä»ç£ç›˜è¯»å–æ–‡ä»¶çš„é¡µç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥**ç¼“å­˜ä»æ–‡ä»¶è¯»å–çš„æ•°æ®**ã€‚è¿™æ ·ï¼Œä¸‹æ¬¡è®¿é—®è¿™äº›æ–‡ä»¶æ•°æ®æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä»å†…å­˜ä¸­å¿«é€Ÿè·å–ï¼Œè€Œä¸éœ€è¦å†æ¬¡è®¿é—®ç¼“æ…¢çš„ç£ç›˜ã€‚

- ç¼“å­˜åŒºï¼Œå°†ç£ç›˜ä¸­çš„å†…å®¹æš‚æ—¶è¯»å…¥åˆ°cacheä¸­å¯ä»¥æé«˜æ•ˆç‡

**èŒƒä¾‹ï¼š**

```bash
[root@8 ~]# free -h
              total        used        free      shared  buff/cache   available
Mem:          941Mi       174Mi       580Mi       6.0Mi       186Mi       620Mi
Swap:            0B          0B          0B
[root@8 ~]# dd if=/dev/sda of=/dev/null bs=300M

#buff/cacheæ˜æ˜¾å¢åŠ 
[root@8 ~]# free -h
              total        used        free      shared  buff/cache   available
Mem:          941Mi       169Mi       365Mi       6.0Mi       405Mi       623Mi
Swap:            0B          0B          0B
```

**æ¸…é™¤buff/cache**

- ç”Ÿäº§ä¸­ä¸è¦ä½¿ç”¨ï¼Œå› ä¸ºbuff/cacheæ˜¯å¯ä»¥æé«˜æ•ˆç‡çš„ï¼Œå¹¶ä¸”æ”¹æˆ3åå°†æ”¹ä¸å›é»˜è®¤å€¼0äº† é™¤éé‡å¯
- å¸®åŠ©ï¼šman proc

```bash
[root@centos8 ~]#echo 3 > /proc/sys/vm/drop_caches
[root@centos8 ~]#free -h
 Â  Â  Â  Â  Â  Â  total Â  Â  Â  used Â  Â  Â  free Â  Â  shared buff/cache Â  available
Mem: Â  Â  Â  Â  Â 1.8Gi Â  Â  Â  320Mi Â  Â  Â  1.3Gi Â  Â  Â  9.0Mi Â  Â  Â  152Mi Â  Â  Â  1.3Gi
Swap: Â  Â  Â  Â  2.0Gi Â  Â  Â  Â  0B Â  Â  Â  2.0Gi
```





# buff & cache æ€»ç»“

- ä¸ºäº†æé«˜æ–‡ä»¶çš„å†™å…¥æ•ˆç‡ï¼Œåœ¨ç°ä»£çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œå½“ç”¨æˆ·è°ƒç”¨ write å‡½æ•°ï¼Œå°†ä¸€äº›æ•°æ®å†™å…¥åˆ°æ–‡ä»¶çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸ä¼šå°†å†™å…¥æ•°æ®æš‚æ—¶ä¿å­˜åœ¨ä¸€ä¸ªå†…å­˜ç¼“å†²åŒºé‡Œé¢ï¼Œç­‰åˆ°ç¼“å†²åŒºçš„ç©ºé—´è¢«å¡«æ»¡ã€æˆ–è€…è¶…è¿‡äº†æŒ‡å®šçš„æ—¶é™ä¹‹åï¼Œæ‰çœŸæ­£çš„å°†ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜é‡Œã€‚

- è¿™ç§åšæ³•è™½ç„¶æé«˜äº†æ•ˆç‡ï¼Œä½†æ˜¯ä¹Ÿä¸ºå†™å…¥æ•°æ®å¸¦æ¥äº†å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå¦‚æœè®¡ç®—æœºå‘ç”Ÿåœæœºï¼Œé‚£ä¹ˆä¿å­˜åœ¨å†…å­˜ç¼“å†²åŒºé‡Œçš„å†™å…¥æ•°æ®å°†ä¼šä¸¢å¤±ã€‚

- ä¸ºæ­¤ï¼Œç³»ç»Ÿæä¾›äº† fsync å’Œ fdatafync ä¸¤ä¸ªåŒæ­¥å‡½æ•°ï¼Œå®ƒä»¬å¯ä»¥å¼ºåˆ¶è®©æ“ä½œç³»ç»Ÿç«‹å³å°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°ç£ç›˜é‡Œé¢ï¼Œä»è€Œç¡®ä¿å†™å…¥æ•°æ®çš„å®‰å…¨æ€§ã€‚
- å¥½æ¯”ä½ åœ¨ window ç³»ç»Ÿæ‰“å¼€ä¸€ä¸ª word æ–‡æ¡£ï¼Œå½“ä½ å†™ä¸€äº›å†…å®¹æ—¶å°±ç›¸å½“äºå†™å…¥ï¼Œä½†æ˜¯ä½ å†™çš„å†…å®¹å¹¶æ²¡æœ‰çœŸæ­£çš„ä¿å­˜ï¼Œè€Œæ˜¯æ”¾åœ¨ä¸€ä¸ªç¼“å†²åŒºï¼Œå¦‚æœè¿™æ—¶å…³é—­çš„è¯å†…å®¹å°±ä¼šä¸¢å¤±ã€‚åªæœ‰å½“ä½ ç‚¹å‡»ä¿å­˜æ—¶å†…å®¹æ‰çœŸæ­£çš„ä¿å­˜ï¼ˆåŒæ­¥ï¼‰åˆ°ç£ç›˜ï¼Œç‚¹å‡»ä¿å­˜å°±å¥½æ¯”è°ƒç”¨åŒæ­¥å‡½æ•° fsync å’Œ fdatafyncã€‚





# buff & cache ç›¸å…³å·¥å…·

```bash
free # æŸ¥çœ‹å†…å­˜ä½¿ç”¨é‡ ä»¥åŠå†…å­˜ä¸­buff/cacheçš„ä½¿ç”¨é‡

sync # å°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°æŒä¹…å­˜å‚¨ä¸­
```







# å†…å­˜å¯»å€èŒƒå›´

å¯»å€èŒƒå›´è®¡ç®—å…¬å¼ï¼šå†…å­˜å®¹é‡ï¼ˆMBï¼‰*8 / å­—é•¿ï¼ˆæŒ‰å­—ç¼–å€ï¼‰

- ```bash
  è‹¥æŸå°å°ç±³ç¬”è®°æœ¬Air 13.3ä¸­å­—é•¿ä¸º64ä½ï¼Œå†…å­˜å®¹é‡ä¸º12GBï¼ŒæŒ‰å­—ç¼–å€ï¼Œåˆ™è¿™å°å°ç±³ç¬”è®°æœ¬å¯å¯»å€èŒƒ
  å›´ä¸ºï¼ˆ1536M ï¼‰
  
  
  1GB =1024MB
  æ•…å¯»å€èŒƒå›´ = 12*1024*8 / 64 = 12*128 =1536M
  ```

  





# ---

# SWAP

- **bufferï¼š**ç¼“å†²åŒºï¼ˆæ•°æ®å†™å…¥ç£ç›˜å‰ ä¸´æ—¶å­˜æ”¾çš„ç©ºé—´ï¼‰
- **cacheï¼š**ç¼“å­˜ï¼ˆå°†ç£ç›˜çš„æ•°æ®å¯¼å…¥åˆ°å†…å­˜ä¸­ æé«˜æ•°æ®çš„è®¿é—®é€Ÿåº¦ï¼‰



## swap æ¦‚è¿°

- ä¸´æ—¶åˆ©ç”¨ç£ç›˜é¡¶æ›¿å†…å­˜ç©ºé—´(é¿å…å› å†…å­˜ä¸è¶³è€Œå¯¼è‡´ç¨‹åºæ‰§è¡Œå¤±è´¥)ï¼Œä½†æ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºç£ç›˜çš„æ€§èƒ½è¿œä¸åŠå†…å­˜
- ç”Ÿäº§ä¸­é€šå¸¸ç¦ç”¨swap



## swap ç›¸å…³å†…æ ¸å‚æ•°

- /proc/sys/vm/swappiness çš„å€¼å†³å®šäº†å½“å†…å­˜å ç”¨è¾¾åˆ°ä¸€å®šç™¾åˆ†æ¯”æ—¶ï¼Œä¼šå¯ç”¨swapåˆ†åŒºç©ºé—´


- **èŒƒä¾‹ï¼š**

```bash
[root@aliyun ~]# cat /proc/sys/vm/swappiness 
30

#ä¸´æ—¶ä¿®æ”¹æ­¤å€¼
[root@aliyun ~]# echo 0 > /proc/sys/vm/swappiness
```

- **è¯´æ˜ï¼š**å†…å­˜åœ¨ä½¿ç”¨åˆ°100-30=70%çš„æ—¶å€™ï¼Œå°±å¼€å§‹ä½¿ç”¨swapç©ºé—´ã€‚ç®€å•è¯´è¿™ä¸ªå€¼å°±æ˜¯å®šä¹‰äº†swapçš„ä½¿ç”¨å€¾å‘ï¼Œé»˜è®¤å€¼ä¸º30ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºè¶Šå€¾å‘äºä½¿ç”¨swapã€‚å¯ä»¥è®¾ä¸º0ï¼Œ0è¡¨ç¤ºæœ€å¤§é™åº¦çš„å‡å°‘ä½¿ç”¨swapï¼Œè€Œä¸æ˜¯ä¸ä½¿ç”¨swapã€‚



## swap ç›¸å…³å‘½ä»¤

**æŸ¥çœ‹swapï¼š**

- swapon -sï¼ˆæœ¬è´¨ä¸Šå°±æŸ¥çœ‹ï¼šcat /proc/swapsï¼‰

  - ```sh
    # å¦‚æœé…ç½®æœ‰å¤šä¸ªswapåˆ†åŒºæˆ–è€…æ–‡ä»¶çš„è¯ï¼Œè¿™é‡Œå°†ä¼šæœ‰å¤šè¡Œï¼Œæ¯è¡Œä»£è¡¨ä¸€ä¸ªæ­£åœ¨è¢«ç³»ç»Ÿä½¿ç”¨çš„swapåˆ†åŒºæˆ–æ–‡ä»¶
    dev@dev:~$ swapon -s
    Filename                Type        Size    Used    Priority
    /dev/dm-1               partition   524284  0       -1
    
    
    Filename # å¦‚æœswapç±»å‹æ˜¯åˆ†åŒºï¼Œè¿™é‡Œå°†æ˜¯åˆ†åŒºçš„è·¯å¾„ï¼Œå¦‚æœswapç±»å‹æ˜¯æ–‡ä»¶ï¼Œè¿™é‡Œå°†æ˜¯æ–‡ä»¶çš„è·¯å¾„
    
    Type # swapçš„ç±»å‹ï¼Œpartitionä»£è¡¨è¿™æ˜¯ä¸€ä¸ªswapåˆ†åŒºï¼Œfileä»£è¡¨è¿™æ˜¯ä¸€ä¸ªswapæ–‡ä»¶
    
    Size # swapçš„å¤§å°ï¼Œå•ä½æ˜¯kï¼Œè¿™é‡Œ524284è¡¨ç¤ºçš„å·®ä¸å¤šæ˜¯512M
    
    Used # å·²ç»è¢«ä½¿ç”¨çš„å¤§å°ï¼Œè¿™é‡Œ0è¡¨ç¤ºè¿˜æ²¡æœ‰è¢«ä½¿ç”¨åˆ°
    
    Priority # ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„swapå°†ä¼šè¢«ä¼˜å…ˆä½¿ç”¨ï¼ŒåŒç­‰ä¼˜å…ˆçº§çš„swapå°†ä¼šè¢«å‡åŒ€çš„ä½¿ç”¨ï¼ˆround-robinç®—æ³•ï¼‰ï¼Œä¼˜å…ˆçº§å¯ä»¥é€šè¿‡â€œswapon -pâ€å‘½ä»¤æ¥è®¾ç½®
    ```

- free -h

- top

**ä¸´æ—¶ç¦ç”¨swapï¼š**

- swapoff /dev/sdc1

**åˆ›å»ºswapæ–‡ä»¶ç³»ç»Ÿï¼š**

- mkswap

**åŒæ­¥swapï¼š**

- swapon -aï¼ˆåˆ›å»ºswapåä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œéœ€è¦åˆ›å»ºswapæ–‡ä»¶ç³»ç»Ÿåè¿›è¡ŒåŒæ­¥ï¼‰



## swap çš„æ•ˆç‡å¯¹æ¯”

- æ•´å—ç¡¬ç›˜çš„swap > åŸºäºåˆ†åŒºçš„swap > åŸºäºæ–‡ä»¶çš„swap
- åŸºäºåˆ†åŒºçš„swap é å‰çš„åˆ†åŒºè¦æ¯”é åçš„åˆ†åŒºé€Ÿåº¦å¿«ï¼Œä½†ä»…é™äºæ™®é€šç£ç›˜ï¼Œå› ä¸ºåˆ†åŒºè€ƒå‰å°±è¡¨ç¤ºç£é“ä¹Ÿé å¤–ï¼Œæ™®é€šç£ç›˜è¯»å–æ•°æ®æ˜¯ä»ç£é“å¤–åˆ°å†…è¯»å–çš„



## swap åˆ›å»º

### åŸºäºåˆ†åŒºåˆ›å»º swap

- **æ³¨æ„**ï¼šç£ç›˜åˆ†åŒºæ“ä½œä¸€å®šè¦å°å¿ƒï¼Œå¼„ä¸å¥½å°±ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€ç³»ç»ŸæŒ‚æ‰çš„åæœã€‚

```bash
# åˆ›å»ºswapåˆ†åŒº
# fdisk /dev/
...
Last sector, +sectors or +size{K,M,G,T,P} (169873408-209715199, default 209715199): +2G #æ·»åŠ ä¸€ä¸ª2Gçš„åˆ†åŒº
Command (m for help): t # ä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿç±»å‹
Partition number (1-5, default 5): 5
...
Hex code (type L to list all codes): 82 # 82è¡¨ç¤ºswapåˆ†åŒº
...
Command (m for help): p
...
/dev/sda5       169873408 174067711   4194304   2G 82 Linux swap / Solaris
Command (m for help): w # å­˜ç›˜é€€å‡º


# åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ
# mkswap /dev/sda5


# æŸ¥çœ‹åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿåçš„swap
# lsblk -f /dev/sda5
NAME FSTYPE LABEL UUID                                 MOUNTPOINT
sda5 swap         548ed2f6-e829-4489-b2ae-471c623c858b
# blkid /dev/sda5
/dev/sda5: UUID="548ed2f6-e829-4489-b2ae-471c623c858b" TYPE="swap" PARTUUID="c0a5b2de-05"


# æŒ‚è½½
# vim /etc/fstab
...
UUID=548ed2f6-e829-4489-b2ae-471c623c858b swap                    swap    defaults        0 0


# åŒæ­¥swap
# swapon -a

# æŸ¥çœ‹åˆ›å»ºçš„swap
# free -h
              total        used        free      shared  buff/cache   available
Mem:          941Mi       190Mi       587Mi       6.0Mi       163Mi       604Mi
Swap:         2.0Gi          0B       2.0Gi
# swapon -s
Filename                                Type            Size    Used    Priority
/dev/sda5                               partition       2097148 0       -2
# cat /proc/swaps
Filename                                Type            Size    Used    Priority
/dev/sda5                               partition       2097148 0       -2
```

### åŸºäºæ–‡ä»¶ swap

- æ³¨æ„ï¼šä¸æ˜¯æ‰€æœ‰çš„æ–‡ä»¶ç³»ç»Ÿéƒ½æ”¯æŒåˆ›å»ºswapæ–‡ä»¶ï¼Œå¦‚btrfsï¼Œåœ¨btrfsåˆ†åŒºé‡Œåˆ›å»ºswapæ–‡ä»¶å°†å¤±è´¥ã€‚

```bash
# åˆ›å»ºswapæ–‡ä»¶
# dd if=/dev/zero of=/data/swapfile bs=1M count=1024

# å°†æ–‡ä»¶æƒé™æ”¹ä¸º600ï¼Œå¦åˆ™åˆ›å»ºæ—¶ä¼šæŠ¥é”™
# chmod 600 /data/swapfile

# åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ
# mkswap /data/swapfile

# æŒ‚è½½
# vim /etc/fstab
...
/data/swapfile                            swap                    swap    defaults        0 0

# åŒæ­¥swap
# swapon -a

# æŸ¥çœ‹åˆ›å»ºçš„swap
# free -h
              total        used        free      shared  buff/cache   available
Mem:          941Mi       195Mi        60Mi       3.0Mi       685Mi       602Mi
Swap:         3.0Gi       4.0Mi       3.0Gi
# swapon -s
Filename                                Type            Size    Used    Priority
/dev/sda5                               partition       2097148 4364    -2
/data/swapfile                          file            1048572 0       -3
```



### åŸºäºç£ç›˜åˆ›å»º swap

- é€šå¸¸ä¸è¿™ä¹ˆåšï¼Œå› ä¸ºä½¿ç”¨æ•´å—ç¡¬ç›˜ç©ºé—´æ¥åˆ›å»ºswapå¤ªå¤§äº†



## swap ä¼˜å…ˆçº§

- ä¼˜å…ˆçº§æ•°å€¼è¶Šé«˜ åˆ™è¶Šä¼˜å…ˆä½¿ç”¨æ­¤swapè®¾å¤‡

```bash
# æå‡swapçš„ä¼˜å…ˆçº§
pri=number # ä½¿ç”¨fstabæ–‡ä»¶æŒ‚è½½æ—¶åœ¨defaultså¤„ä¿®æ”¹
# ç„¶åå¯ä»¥ä½¿ç”¨swapon -sæŸ¥çœ‹
```



## swap ç¦ç”¨

```sh
# åœæ‰æ‰€æœ‰ç³»ç»Ÿæ­£åœ¨ä½¿ç”¨çš„swap
# swapoff -a
 
#swapon -så‘½ä»¤æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œfreeå‘½ä»¤æ˜¾ç¤ºswapç©ºé—´ä¸º0ï¼Œè¯´æ˜swapoffæˆåŠŸ
# swapon -s
# free
              total        used        free      shared  buff/cache   available
Mem:         500192       35924      348888        2004      115380      433924
Swap:             0           0           0
 
# å½“ç„¶æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹/etc/fstabï¼Œå¦åˆ™ä¸‹æ¬¡é‡å¯åï¼Œç³»ç»Ÿåˆä¼šé‡æ–°æŒ‚è½½ç›¸åº”çš„swapåˆ†åŒºå’Œæ–‡ä»¶
# ä½¿ç”¨è‡ªå·±å–œæ¬¢çš„ç¼–è¾‘å™¨ï¼Œå°†/etc/fstabä¸­è·Ÿswapç›¸å…³çš„ä¸‰è¡Œåˆ æ‰å³å¯(æœ¬ä¾‹ä¸­æ˜¯ä¸‰è¡Œï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´)
```





## swap èŒƒä¾‹

```bash
#æœªå¯ç”¨swap
# free -h
              total        used        free      shared  buff/cache   available
Mem:          941Mi       204Mi       365Mi        18Mi       371Mi       562Mi
Swap:            0B          0B          0B


#600Mçš„æ–‡ä»¶å¯ä»¥åˆ›å»º
# dd if=/dev/zero of=file.img bs=600M count=1
# ll -h file.img
-rw-r--r-- 1 root root 600M Apr  5 10:45 file.img


#800Mçš„æ–‡ä»¶å°±å·²ç»æç¤ºè¿›ç¨‹è¢«killæ‰äº†ï¼Œå…¶å®å°±æ˜¯å†…å­˜ä¸è¶³æ‰€å¯¼è‡´
# dd if=/dev/zero of=file2.img bs=800M count=1
Killed
# ll -h file2.img
-rw-r--r-- 1 root root 0 Apr  5 10:47 file2.img


#æ·»åŠ swap


#å†æ¬¡æµ‹è¯•
```



## æŸ¥çœ‹ç³»ç»Ÿä¸­swap in/outçš„æƒ…å†µ

å¹¶ä¸æ˜¯swapç©ºé—´å ç”¨å¤šå°±ä¸€å®šæ€§èƒ½ä¸‹é™ï¼ŒçœŸæ­£å½±å“æ€§èƒ½æ˜¯swap inå’Œoutçš„é¢‘ç‡ï¼Œé¢‘ç‡è¶Šé«˜ï¼Œå¯¹ç³»ç»Ÿçš„æ€§èƒ½å½±å“è¶Šå¤§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡vmstatå‘½ä»¤æ¥æŸ¥çœ‹swap in/outçš„é¢‘ç‡

å¦‚æœswapå®¹é‡å›ºå®šä¸å˜ï¼Œé‚£å†…å­˜å°±ä¸æ˜¯ç“¶é¢ˆã€‚å¯ä»¥ç”¨vmstat 1å‘½ä»¤çœ‹ï¼Œsi soä¸¤åˆ—çš„æ•°å€¼åœ¨ä¸æ–­å˜åŒ–æ—¶ï¼Œå†…å­˜å°±ä¸å¤Ÿäº†ã€‚

```bash
# å‚æ•°2è¡¨ç¤ºæ¯ä¸¤ç§’ç»Ÿè®¡ä¸€æ¬¡ï¼Œsiå’Œsoä¸¤åˆ—å°±æ˜¯æ¯ç§’swap inå’Œoutçš„æ¬¡æ•°
dev@ubuntu:~$ vmstat 2
procs------------memory--------------swap----io-----system-----------cpu-----
 r b    swpd  free  buff cache      si so   bi bo   in  cs      us sy id wa st
 0 0    70232 75620 7940 209476     0  0    0  0    111 180     0  1  99 0  0
 0 0    70232 75620 7940 209476     0  0    0  0    116 186     1  1  99 0  0
 0 0    70228 75620 7940 209476     2  0    2  0    120 193     1  1  98 1  0
 0 0    70228 75620 7940 209476     0  0    0  0    117 186     0  0  100 0 0
 0 0    70228 75620 7940 209476     0  0    0  0    113 184     0  1  99 0  0
```
