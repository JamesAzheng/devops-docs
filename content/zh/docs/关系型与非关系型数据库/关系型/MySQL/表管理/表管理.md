

# 查看表

## 查看数据库中的表

- 进入数据库查看

```sql
#进入数据库
mysql> use testdb;

#查看
mysql> show tables;
+------------------+
| Tables_in_testdb |
+------------------+
| t1               |
+------------------+
```

- 不进入数据库查看

```sql
mysql> show tables from testdb;
+------------------+
| Tables_in_testdb |
+------------------+
| t1               |
+------------------+
```

## 查看表结构

- 语法1`DESC[RIBE] [db_name.]tb_name;`（常用）：

```sql
mysql> desc hellodb.students;
+-----------+------------------+------+-----+---------+----------------+
| Field     | Type             | Null | Key | Default | Extra          |
+-----------+------------------+------+-----+---------+----------------+
| StuID     | int unsigned     | NO   | PRI | NULL    | auto_increment |
| Name      | varchar(50)      | NO   |     | NULL    |                |
| Age       | tinyint unsigned | NO   |     | NULL    |                |
| Gender    | enum('F','M')    | NO   |     | NULL    |                |
| ClassID   | tinyint unsigned | YES  |     | NULL    |                |
| TeacherID | int unsigned     | YES  |     | NULL    |                |
+-----------+------------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)
```

- 语法2 `SHOW COLUMNS FROM [db_name.]tb_name;`：

```sql
mysql> SHOW COLUMNS FROM hellodb.students;
+-----------+------------------+------+-----+---------+----------------+
| Field     | Type             | Null | Key | Default | Extra          |
+-----------+------------------+------+-----+---------+----------------+
| StuID     | int unsigned     | NO   | PRI | NULL    | auto_increment |
| Name      | varchar(50)      | NO   |     | NULL    |                |
| Age       | tinyint unsigned | NO   |     | NULL    |                |
| Gender    | enum('F','M')    | NO   |     | NULL    |                |
| ClassID   | tinyint unsigned | YES  |     | NULL    |                |
| TeacherID | int unsigned     | YES  |     | NULL    |                |
+-----------+------------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)
```



## 查看表创建命令

- 语法：

```sql
SHOW CREATE TABLE tbl_name
```

- 范例：

```sql
mysql> show create table t1\G
*************************** 1. row ***************************
       Table: t1
Create Table: CREATE TABLE `t1` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4294967295 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
1 row in set (0.00 sec)
```

## 查看表状态

- 语法：

```sql
SHOW TABLE STATUS LIKE 'tbl_name'
```

- 范例：

```sql
mysql> SHOW TABLE STATUS LIKE 't1'\G
*************************** 1. row ***************************
           Name: t1
         Engine: InnoDB
        Version: 10
     Row_format: Dynamic
           Rows: 2
 Avg_row_length: 8192
    Data_length: 16384
Max_data_length: 0
   Index_length: 0
      Data_free: 0
 Auto_increment: 4294967295
    Create_time: 2022-05-13 14:25:30
    Update_time: 2022-05-13 14:26:54
     Check_time: NULL
      Collation: utf8mb4_0900_ai_ci
       Checksum: NULL
 Create_options: 
        Comment: 
1 row in set (0.00 sec)
```

## 查看库中所有表状态

- 语法：

```sql
SHOW TABLE STATUS FROM db_name;
```

- 范例：

```sql
mysql> SHOW TABLE STATUS FROM testdb\G
...
```



## 查看支持的engine类型

- 一般默认为 InnoDB 存储引擎，无需修改

```sql
SHOW ENGINES;
```











# 修改表

## 修改表语法

```sql
ALTER TABLE 'tbl_name'
#字段：
#添加字段：add
ADD col1 data_type [FIRST|AFTER col_name] 
#删除字段：drop
#修改字段：
alter（默认值）, change（字段名）, modify（字段属性）


#帮助
Help ALTER TABLE
```

## 修改表范例

```sql
ALTER TABLE students RENAME s1;
ALTER TABLE s1 ADD phone varchar(11) AFTER name;
ALTER TABLE s1 MODIFY phone int;
ALTER TABLE s1 CHANGE COLUMN phone mobile char(11);
ALTER TABLE s1 DROP COLUMN mobile;
ALTER TABLE s1 character set utf8;
ALTER TABLE s1 change name name varchar(20) character set utf8;
ALTER TABLE students ADD gender ENUM('m','f');
ALETR TABLE students CHANGE id sid int UNSIGNED NOT NULL PRIMARY KEY; 
ALTER TABLE students DROP age;
DESC students;


#新建表无主键，添加和删除主键
CREATE TABLE t1 SELECT * FROM students;
ALTER TABLE t1 add primary key (stuid);
ALTER TABLE t1 drop primary key ;
```

### 修改表中列名称

```sql
MariaDB [hellodb]> desc emp;
+--------+-------------+------+-----+---------+----------------+
| Field  | Type        | Null | Key | Default | Extra          |
+--------+-------------+------+-----+---------+----------------+
| id     | int(11)     | NO   | PRI | NULL    | auto_increment |
| name   | varchar(20) | YES  |     | NULL    |                |
| leader | int(11)     | YES  |     | NULL    |                |
+--------+-------------+------+-----+---------+----------------+
MariaDB [hellodb]> alter table emp change leader leader_id int;
MariaDB [hellodb]> desc emp;
+-----------+-------------+------+-----+---------+----------------+
| Field     | Type        | Null | Key | Default | Extra          |
+-----------+-------------+------+-----+---------+----------------+
| id        | int(11)     | NO   | PRI | NULL    | auto_increment |
| name      | varchar(20) | YES  |     | NULL    |                |
| leader_id | int(11)     | YES  |     | NULL    |                |
+-----------+-------------+------+-----+---------+----------------+
```







# 删除表

## 删除表语法

```sql
DROP TABLE [IF EXISTS] 'tbl_name';
```





# 插入表字段

- 简化语法：

```sql
INSERT tbl_name [(col1,...)] VALUES (val1,...), (val21,...)
```

## 范例

### 范例1

```sql
mysql> insert into t1 values(null); #在t1表中添加一条空记录
```

### 范例2

```sql
#原有表内容
MariaDB [test]> SELECT * FROM student;
+----+----------+------+--------+
| id | name     | age  | gender |
+----+----------+------+--------+
| 10 | xiaoming |   20 | M      |
| 11 | xiaohong |   18 | F      |
+----+----------+------+--------+


#在全部字段都添加值时，value前不用加对应的字段，但要注意按照表中的顺序依次添加
MariaDB [test]> INSERT student VALUES (1,'xiaoxiang',23,'M'); #添加值时，注意字符需要添加单引号''
MariaDB [test]> SELECT * FROM student;
+----+-----------+------+--------+
| id | name      | age  | gender |
+----+-----------+------+--------+
|  1 | xiaoxiang |   23 | M      |
| 10 | xiaoming  |   20 | M      |
| 11 | xiaohong  |   18 | F      |
+----+-----------+------+--------+

#在个别字段添加值时，value前需要加对应的字段（且字段前后要相对应）
MariaDB [test]> INSERT student (name,age,gender) VALUES ('azheng',25,'M');
MariaDB [test]> SELECT * FROM student;
+----+-----------+------+--------+
| id | name      | age  | gender |
+----+-----------+------+--------+
|  1 | xiaoxiang |   23 | M      |
| 10 | xiaoming  |   20 | M      |
| 11 | xiaohong  |   18 | F      |
| 12 | azheng    |   25 | M      |
+----+-----------+------+--------+

#添加多条记录
MariaDB [test]> INSERT student (name,age,gender) VALUES ('a',16,'M'),('b',17,'F'),('c',18,'F');
MariaDB [test]> SELECT * FROM student;
+----+-----------+------+--------+
| id | name      | age  | gender |
+----+-----------+------+--------+
|  1 | xiaoxiang |   23 | M      |
| 10 | xiaoming  |   20 | M      |
| 11 | xiaohong  |   18 | F      |
| 12 | azheng    |   25 | M      |
| 13 | a         |   16 | M      |
| 14 | b         |   17 | F      |
| 15 | c         |   18 | F      |
+----+-----------+------+--------+

#将student表的内容插入到t1表（要求字段必须一致，否则会报错）
MariaDB [test]> INSERT t1 SELECT * FROM student;
ERROR 1136 (21S01): Column count doesn't match value count at row 1

#较少使用的一种插入内容语法
MariaDB [test]> select * from student;
+----+-----------+------+--------+
| id | name      | age  | gender |
+----+-----------+------+--------+
|  1 | xiaoxiang |   23 | M      |
| 10 | xiaoming  |   20 | M      |
| 11 | xiaohong  |   18 | F      |
| 12 | azheng    |   25 | M      |
| 13 | a         |   16 | M      |
| 14 | b         |   17 | F      |
| 15 | c         |   18 | F      |
+----+-----------+------+--------+
MariaDB [test]> insert student set id=66,age=88,gender='M',name='lala';
MariaDB [test]> select * from student;
+----+-----------+------+--------+
| id | name      | age  | gender |
+----+-----------+------+--------+
|  1 | xiaoxiang |   23 | M      |
| 10 | xiaoming  |   20 | M      |
| 11 | xiaohong  |   18 | F      |
| 12 | azheng    |   25 | M      |
| 13 | a         |   16 | M      |
| 14 | b         |   17 | F      |
| 15 | c         |   18 | F      |
| 66 | lala      |   88 | M      |
+----+-----------+------+--------+
```





# 更新表字段

- 语法：

```sql
UPDATE [LOW_PRIORITY] [IGNORE] table_reference
 ? ?SET col_name1={expr1|DEFAULT} [, col_name2={expr2|DEFAULT}] ...
 ? [WHERE where_condition]
 ? [ORDER BY ...]
 ? [LIMIT row_count]
```

- **注意：一定要有限制条件，否则将修改所有行的指定字段，可利用mysql 选项避免此错误：**

```bash
mysql -U | --safe-updates| --i-am-a-dummy

#或

[root@centos8 ~]#vim /etc/my.cnf
[mysql]
safe-updates
```

## 更新表字段范例

### 范例1

```sql
#现有表数据
mysql> select * from student;
+----+----------+------+--------+
| id | name     | age  | gender |
+----+----------+------+--------+
| 10 | xiaoming |   20 | M      |
| 11 | xiaohong |   18 | F      |
+----+----------+------+--------+

#不加where条件更新年龄 将导致表中此字段的所有值都被修改
mysql> update student set age=123;
mysql> select * from student;
+----+----------+------+--------+
| id | name     | age  | gender |
+----+----------+------+--------+
| 10 | xiaoming |  123 | M      |
| 11 | xiaohong |  123 | F      |
+----+----------+------+--------+

#添加安全更新选项
[root@mysql ~]# vim /etc/my.cnf
[mysql]
safe-updates

#再次执行被拒绝
mysql> update student set age=321;
ERROR 1175 (HY000): You are using safe update mode and you tried to update a table without a WHERE that uses a KEY column.

#添加where条件进行更新 可以更新
mysql> update student set age=18 where id=11;
mysql> select * from student;
+----+----------+------+--------+
| id | name     | age  | gender |
+----+----------+------+--------+
| 10 | xiaoming |  123 | M      |
| 11 | xiaohong |   18 | F      |
+----+----------+------+--------+
```

### 范例2

```sql
MariaDB [test]> select * from student;
+----+------+------+--------+
| id | name | age  | gender |
+----+------+------+--------+
| 14 | b    |   17 | F      |
| 15 | c    |   18 | F      |
+----+------+------+--------+

MariaDB [test]> UPDATE student set name='a' WHERE id=14; 

MariaDB [test]> select * from student;
+----+------+------+--------+
| id | name | age  | gender |
+----+------+------+--------+
| 14 | a    |   17 | F      |
| 15 | c    |   18 | F      |
+----+------+------+--------+

#多个字段同时修改
MariaDB [test]> select * from student;
+----+------+------+--------+
| id | name | age  | gender |
+----+------+------+--------+
| 14 | a    |   17 | F      |
| 15 | c    |   18 | F      |
+----+------+------+--------+

MariaDB [test]> UPDATE student set id=1,age=123 WHERE name='a'; 

MariaDB [test]> select * from student;
+----+------+------+--------+
| id | name | age  | gender |
+----+------+------+--------+
|  1 | a    |  123 | F      |
| 15 | c    |   18 | F      |
+----+------+------+--------+
```

### 危险操作举例

```sql
mysql> select * from teachers;
+-----+---------------+-----+--------+
| TID | Name          | Age | Gender |
+-----+---------------+-----+--------+
|   1 | Song Jiang    |  45 | M      |
|   2 | Zhang Sanfeng |  94 | M      |
|   3 | Miejue Shitai |  77 | F      |
|   4 | Lin Chaoying  |  93 | F      |
|   5 | xiangzheng    |  23 | NULL   |
+-----+---------------+-----+--------+
5 rows in set (0.00 sec)

mysql> update teachers set age='66';
Query OK, 5 rows affected (4.04 sec)
Rows matched: 5  Changed: 5  Warnings: 0

#全部年龄都被修改成66了，很危险！
mysql> select * from teachers;
+-----+---------------+-----+--------+
| TID | Name          | Age | Gender |
+-----+---------------+-----+--------+
|   1 | Song Jiang    |  66 | M      |
|   2 | Zhang Sanfeng |  66 | M      |
|   3 | Miejue Shitai |  66 | F      |
|   4 | Lin Chaoying  |  66 | F      |
|   5 | xiangzheng    |  66 | NULL   |
+-----+---------------+-----+--------+
```





# 删除表字段

## 注意事项

- **删除表中数据 不会自动缩减数据文件的大小，需要使用 `OPTIMIZE TABLE tb_name` 来将表空间缩减**


## 删除表语法

```sql
DELETE [LOW_PRIORITY] [QUICK] [IGNORE] FROM tbl_name
[WHERE where_condition]
[ORDER BY ...]
[LIMIT row_count]
#可先排序再指定删除的行数
```

## 删除表字段范例

```sql
#现有表内容
mysql> select * from student;
+----+----------+------+--------+
| id | name     | age  | gender |
+----+----------+------+--------+
| 10 | xiaoming |  123 | M      |
| 11 | xiaohong |   18 | F      |
+----+----------+------+--------+

#删除表内容
mysql> delete from student where id=11;

#删除后的内容
mysql> select * from student;
+----+----------+------+--------+
| id | name     | age  | gender |
+----+----------+------+--------+
| 10 | xiaoming |  123 | M      |
+----+----------+------+--------+
```

## 删除全为NULL的字段

```sql
#语法
delete from 表名 where 字段 is NULL

#范例
mysql> select * from t1;
+------+------+
| id   | name |
+------+------+
|    1 | a    |
| NULL | NULL |
| NULL | NULL |
+------+------+
mysql> delete from t1 where id is NULL;
mysql> select * from t1;
+------+------+
| id   | name |
+------+------+
|    1 | a    |
+------+------+
```



## 清空表中内容

- 表结构会保留
- **慎用**

### 语法1

- 此语句会自动缩减数据文件的大小，速度更快，mysql -U 无法对其加以限制

```sql
TRUNCATE TABLE tbl_name;
```

### 语法2

- 此语句不会自动缩减数据文件的大小，速度较慢，mysql -U 可以对其加以限制

```sql
DELETE FROM student;
```





# 在表中插入内容

```sql
#INSERT帮助
MariaDB [(none)]> HELP INSERT;

mysql> insert into t1 values(null); #在t1表中添加一条空记录
```











