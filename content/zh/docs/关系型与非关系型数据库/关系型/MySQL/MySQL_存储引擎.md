# 存储引擎概述

- 目前最主流的存储引擎是innoDB，早期还有MyISAM存储引擎 不过目前基本已经淘汰
- 存储引擎负责把具体分析的结果完成对磁盘上文件路径访问的转换



# MyISAM 存储引擎

### 特点

- 不支持事务
- 表级锁定
- 读写相互阻塞，写入不能读，读时不能写
- 只缓存索引
- 不支持外键约束
- 不支持聚簇索引
- 读取数据较快，占用资源较少
- 不支持MVCC（多版本并发控制机制）高并发
- 崩溃恢复性较差
- MySQL5.5.5前默认的数据库引擎

### 适用场景

- 只读（或者写较少）
- 表较小（可以接受长时间进行修复操作

### MyISAM引擎文件

- tbl_name.frm 表格式定义
- tbl_name.MYD 数据文件
- tbl_name.MYI 索引文件



# InnoDB 存储引擎

### 特点

- 行级锁
- 支持事务，适合处理大量短期事务
  - 数据一致性

- 读写阻塞与事务隔离级别相关
- 可缓存数据和索引
- 支持聚簇索引
- 支持外键
- 支持数据缓存
- 崩溃恢复性更好
- 支持MVCC高并发
  - MVCC：数据库表中其实是隐藏了insert和delete这两个字段，这两个字段记录了事件发生的先后次序(可以理解为时间戳)，而将表中添加字段时本质上是先插入一个字段 然后再将这个插入的字段中的insert字段添加一个类似时间戳的信息 用来记录字段插入的事件，最后再将原有的字段中的insert字段也记录一个类似时间戳的信息 来标明被删除的时间，这时用户就只能看到新添加的字段了 但原有的字段其实并未删除 只是做了个标记而已，正因为这种机制可以很好的记录事件的发生时间 防止数据查询错误的情况产生 进而可以实现高并发访问

- 从MySQL5.5后支持全文索引
- 从MySQL5.5.5开始为默认的数据库引擎



### InnoDB数据库文件

```sql
#所有InnoDB表的数据和索引放置于同一个表空间中
数据文件：ibdata1, ibdata2,存放在datadir定义的目录下
表格式定义：tb_name.frm,存放在datadir定义的每个数据库对应的目录下

#每个表单独使用一个表空间存储表的数据和索引
两类文件放在对应每个数据库独立目录中
数据文件(存储数据和索引)：tb_name.ibd 
表格式定义：tb_name.frm
```



# 事务的四大特性

**原子性**（Atomicity）

- 原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。 

**一致性**（Consistency）

- 在一个事务中，事务前后数据的完整性必须保持一致，可以想象银行转账、火车购票。

**隔离性**（Isolation）

- 多个事务，事务的隔离性是指多个用户并发访问数据库时， 一个用户的事务不能被其它用户的事务所干扰，多个并发事务之间数据要相互隔离。

**持久性**（Durability）

- 持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响。



# 管理存储引擎

- MySQL5.5.5后默认的存储引擎即为InnoDB

#### 查看mysql支持的存储引擎

```sql
show engines;
```

#### 查看当前默认的存储引擎

```sql
show variables like '%storage_engine%';  
```

#### 临时关闭或开启innodb存储引擎

```sql
innodb_file_per_table=ON
```

#### 设置默认的存储引擎

```bash
# vim /etc/my.cnf
[mysqld]
default_storage_engine= InnoDB
```

#### 查看库中所有表使用的存储引擎

```sql
show table status from db_name;
```

#### 查看库中指定表的存储引擎

```sql
show table status like  'tb_name';
#或
show create table tb_name;
```

#### 设置表的存储引擎

```sql
#创建表时指定存储引擎
CREATE TABLE tb_name(... ) ENGINE=InnoDB;

#修改现有表的存储引擎
ALTER TABLE tb_name ENGINE=InnoDB;
```





