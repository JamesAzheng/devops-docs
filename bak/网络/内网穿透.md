# 内网穿透概述

内网穿透是指将内部网络的服务暴露到公网上，使外部用户可以访问内网服务。通常情况下，内部网络是被路由器等网络设备所保护的，外部用户无法直接访问内部网络中的设备和服务。而通过内网穿透技术，可以将内部网络的服务通过公网访问。

内网穿透通常用于以下场景：

- 远程访问内网服务器

如果内网有一台服务器，需要远程访问该服务器，但是服务器所在的网络没有公网IP地址或者被路由器等网络设备所保护，那么可以通过内网穿透技术，将服务器的服务暴露到公网上，从而可以在外部网络上访问该服务器。

- 局域网游戏联机

在局域网中，玩家可以通过局域网游戏进行联机游戏。但是如果想要和其他地区的玩家进行游戏，就需要将局域网游戏服务暴露到公网上，从而可以和其他地区的玩家进行游戏。

- 个人网站访问

如果个人网站搭建在内网上，那么只有在内网中的设备可以访问该网站。如果想要让其他地区的用户访问该网站，可以通过内网穿透技术将网站服务暴露到公网上，从而实现公网访问。

实现内网穿透的技术有很多种，常见的有端口映射、VPN、SSH隧道等。其中，端口映射是最常用的一种方式。通过路由器等网络设备将内部网络的端口映射到公网上，从而实现内网穿透。但是端口映射需要公网IP地址和端口的配合，如果公网IP地址是动态的，那么需要使用DDNS等技术来动态更新公网IP地址。

除了端口映射，还可以使用专门的内网穿透软件来实现内网穿透，如frp、ngrok、花生壳等。这些软件可以通过中转服务器的方式将内网服务暴露到公网上，使用起来相对简单，而且支持多种协议和安全加密等功能。

需要注意的是，内网穿透会增加网络的风险，因为暴露在公网上的服务容易受到攻击。因此，在使用内网穿透技术时，需要加强网络安全措施，保护网络的安全。



**内网穿透类似于DNAT对吗** 

是的，内网穿透可以类比于DNAT（Destination Network Address Translation，目的地址转换），在网络传输中，DNAT会将请求转发到内网中指定的IP地址和端口号，从而实现公网访问内网服务。内网穿透的作用也类似于DNAT，将内网服务映射到公网上，使得外部用户可以访问内网服务。不过，内网穿透还需要考虑一些安全问题，如加密传输、身份认证等，以保障数据安全性。



# 实现内网穿透的工具

实现内网穿透的工具有很多，以下是一些常用的工具：

1. ngrok

ngrok 是一款开源的内网穿透工具，支持多种操作系统，如Windows、macOS、Linux等。ngrok 可以通过HTTP、TCP等协议将内网服务映射到公网上，使用起来比较简单，而且支持自定义子域名、HTTPS加密等功能。

1. frp

frp 是一款快速、简单的内网穿透工具，可以支持HTTP、TCP等协议的映射。frp 使用 C/S（客户端/服务器）模式进行数据传输，可以使用多种加密算法保障数据安全。

1. 花生壳

花生壳是一款易于使用的内网穿透工具，支持Windows、macOS等操作系统。花生壳可以将内网服务映射到公网上，从而实现公网访问。花生壳支持多种协议，如HTTP、TCP等，同时还提供DDNS功能，支持动态IP地址。

1. 其他工具

除了上述工具之外，还有很多其他的内网穿透工具，如TinyPortMapper、hole、z_tcp_tun等。这些工具都有各自的优缺点，需要根据具体需求选择合适的工具。

需要注意的是，内网穿透工具使用时需要加强安全措施，避免被攻击或滥用。建议在使用内网穿透工具时，采取合适的加密措施，同时避免将敏感信息暴露在公网上。





# socat 实现内网穿透

socat是一款功能强大的网络工具，可以用来在不同的网络之间建立连接和传输数据。它可以帮助我们实现内网穿透，即将内部网络的服务暴露到公网上，从而使外部用户可以访问内网服务。

下面是使用socat实现内网穿透的步骤：

​    1.在内网主机上运行socat

假设我们要将内网主机的SSH服务暴露到公网上，首先在内网主机上运行以下命令：

```sh
socat TCP-LISTEN:2222,reuseaddr,fork TCP:localhost:22
```

该命令将在内网主机上启动一个TCP监听器，监听2222端口，并将接收到的数据转发到本地的SSH服务（即localhost的22端口）。fork选项表示每次有新的连接到达时都会产生一个新的子进程，从而实现并发处理。

   2.在公网服务器上运行socat

接下来在公网服务器上运行以下命令：

```sh
socat TCP-LISTEN:3333,reuseaddr,fork TCP:内网主机的公网IP地址:2222
```

该命令将在公网服务器上启动一个TCP监听器，监听3333端口，并将接收到的数据转发到内网主机的2222端口。这样，外部用户就可以通过公网服务器的3333端口访问内网主机的SSH服务了。

需要注意的是，我们需要知道内网主机的公网IP地址，并且需要将内网主机的2222端口映射到公网路由器上，使公网服务器能够访问到该端口。

以上就是使用socat实现内网穿透的步骤，可以根据实际情况进行调整和优化。