# TCP

TCP（Transmission Control Protocol）是一种面向连接的传输层协议，它提供可靠的、有序的数据传输机制，适用于对数据可靠性和顺序性要求较高的应用。

下面是对TCP的详细解释：

1. 面向连接：TCP在数据传输之前需要建立一个持久的连接。连接建立过程包括三次握手，即发送方向接收方发送一个连接请求，接收方确认请求，并向发送方发送确认，最后发送方再次确认接收方的确认。这样建立的连接为数据传输提供了可靠的通道。
2. 可靠性：TCP提供可靠的数据传输机制。它通过使用确认、序列号和重传等机制来确保数据的正确性和完整性。每个TCP报文段都有一个序列号，接收方使用序列号来确认已经接收到的数据，并对缺失的数据进行重传。发送方通过等待确认来确保数据的可靠传输。
3. 流量控制：TCP使用滑动窗口机制进行流量控制。接收方通过通告窗口大小告知发送方自己的接收能力，发送方根据接收方的窗口大小来控制发送的数据量，以避免过载接收方。
4. 拥塞控制：TCP具有拥塞控制机制，用于在网络拥塞时减少数据包的发送速率，以避免网络负载过重导致的丢包和性能下降。拥塞控制包括慢启动、拥塞避免和快速重传等算法。
5. 面向字节流：TCP将应用程序发送的数据视为一连串的字节流，而不是分割为独立的数据包。TCP通过数据段的分割和重组来保证数据的有序性和可靠性。
6. 支持全双工通信：TCP支持全双工通信，即发送方和接收方可以同时进行数据传输。每个TCP连接都有两个独立的方向，允许双方同时发送和接收数据。

TCP在互联网中得到广泛应用，特别适用于对数据可靠性和有序性要求较高的应用场景，如文件传输、电子邮件、Web浏览等。然而，由于TCP在保证可靠性和顺序性方面的开销较大，它的传输延迟相对较高。对于对实时性要求较高的应用，如实时音视频传输和游戏，UDP可能更适合使用。



## TCP 特性

- **工作在传输层**：TCP是在计算机网络中的传输层上工作的协议。它负责在网络中的两个应用程序之间提供可靠的、面向连接的数据传输。
- **面向连接协议**：在使用TCP传输数据之前，必须先建立一个连接。连接的建立包括三次握手过程，即发送方向接收方发送一个连接请求，接收方回复确认，最后发送方再次回复确认，建立连接后才能进行数据传输。
- **全双工协议**：TCP连接是全双工的，意味着两端可以同时发送和接收数据。这使得数据的双向传输可以同时进行，提高了通信的效率。
- **半关闭**：TCP连接中的一端可以先关闭发送数据的能力，而仍然可以接收来自另一端的数据。当一端完成数据发送后，可以发送一个关闭连接的请求，另一端接收到请求后可以继续发送数据，然后再关闭连接，实现半关闭的状态。
- **错误检查**：TCP使用校验和机制对数据进行错误检查，以确保数据在传输过程中没有发生损坏或错误。
- **将数据打包成段，排序**：TCP将应用程序传输的数据进行分段，每个段被封装在一个TCP报文段中。这些段按序号进行排序，以确保数据在接收端按正确的顺序重组。
- **确认机制**：TCP使用确认机制来确保数据的可靠传输。接收方会向发送方发送确认消息，以确认已经成功接收到数据。
- **数据恢复，重传**：如果发送方未收到确认消息或接收到重复的确认消息，它将认为数据丢失或损坏，并进行相应的重传操作，确保数据的可靠性。
- **流量控制，滑动窗口**：TCP使用滑动窗口机制来进行流量控制。接收方通过发送窗口大小告知发送方可以接收的数据量，发送方根据接收方的窗口大小来控制发送的数据量，以避免发送速度过快导致接收方缓冲区溢出。
- **拥塞控制，慢启动和拥塞避免算法**：TCP使用拥塞控制机制来避免网络拥塞。在连接建立后，发送方会通过慢启动算法逐渐增加发送窗口的大小，然后使用拥塞避免算法在网络中维持适当的发送速率，以避免过多的数据拥塞网络。如果检测到网络拥塞，TCP会减少发送速率以缓解拥塞情况。





## TCP 内核相关参数

- 详参`man 7 tcp`

TCP的内核相关参数主要用于配置TCP协议栈的行为和性能。以下是一些常见的TCP内核参数：





## TCP 包头结构

TCP包头结构的各个字段在数据传输过程中起着重要的作用，用于控制连接的建立、维护和关闭，保证数据的可靠传输，以及提供流量控制和拥塞控制等功能。对于理解和分析TCP通信，了解包头结构及其字段的含义非常重要。

- 每行长度为32位bit，即4byte
- TCP包头的大小不是固定的，但最少为5行，即20byte。
- 选项和填充为可选，其它为必选。

<img src="images\tcp包头结构.png" alt="tcp包头结构"  />

### 源和目标端口号

- 分别指定源主机和目标主机的端口号，用于标识通信的应用程序。
- 源端口和目标端口分别占用16bit，即2byte

#### 判断端口是否监听

- 的小技巧

```sh
# ss -ntl | awk '{print $1 " " $4}'
State Local
LISTEN 0.0.0.0:9527
LISTEN 0.0.0.0:443
LISTEN 127.0.0.1:9000
LISTEN 0.0.0.0:1194
LISTEN 0.0.0.0:80
LISTEN *:3306


# ls /dev/tcp/127.0.0.1/9527
ls: cannot access '/dev/tcp/127.0.0.1/9527': No such file or directory


# 监听返回0
# < /dev/tcp/127.0.0.1/9527
# echo $?
0


# 未监听返回0
# < /dev/tcp/127.0.0.1/9528
-bash: connect: Connection refused
-bash: /dev/tcp/127.0.0.1/9528: Connection refused
# echo $?
1
```



### 序列号

- Sequence Number

- 指定TCP报文段中第一个数据字节的序列号。用于对数据进行有序的传输和重组。
- 表示本报文段所发送数据的第一个字节的编号。在TCP连接中所传送的字节流的每一个字节都会按顺序编号。由于序列号由32位表示，所以每2^32个字节，就会出现序列号回绕，再次从0 开始
- 1~32 bit 的序号 seq（2^32-1个，约43亿个）



### 确认号

- Acknowledgment Number

- 指定期望接收到的下一个字节的序列号。用于确认已经收到的数据并进行可靠的传输。
- 表示接收方期望收到发送方下一个报文段的第一个字节数据的编号。也就是告诉发送方：我希望你（指发送方）下次发送的数据的第一个字节数据的编号为此确认号
- seq+1，表示下次希望发送seq+1的包，变相的表示seq的这个包我收到了



### 数据偏移

- Data Offset

- 指定TCP报文段中数据部分的起始位置相对于TCP头部的偏移量。它表示TCP头部的长度，以32位字（4字节）为单位。
- 前4位表示数据偏移，表示tcp头部的长度，即有几行
- 数据偏移：表示TCP报文段的首部长度，共4位，由于TCP首部包含一个长度可变的选项部分，需要指定这个TCP报文段到底有多长。它指出 TCP 报文段的数据起始处距离 TCP 报文段的起始处有多远。该字段的单位是32位(即4个字节为计算单位），4位二进制最大表示15，所以数据偏移也就是TCP首部最大60字节



### 保留位

- 保留供将来使用，目前保留为0。
- 5-9位保留，目前没有用上



### 标志位

- Flags

- TCP头部中的6个标志位用于控制TCP连接和数据的传输：

  - URG（紧急指针有效）：指示紧急指针字段是否有效。
    - 紧急数据位，表示后面的紧急指针字段只有当URG=1时才有效

  - ACK（确认号有效）：指示确认号字段是否有效。
    - 和确认号中的ack不是一回事，这里的ACK表示只有当ACK=1时，前面的确认号字段才有效

  - PSH（推送数据）：指示接收方是否应该尽快将数据交给应用程序。
    - 如果PSH=1，则表示对方应当立即把数据提交给上层应用，而不是缓存起来，如果应用程序不将接收到的数据读走，就会一直停留在TCP接收缓冲区中，反之PSH=0则会缓存一段时间在将数据报文提交给应用上层

  - RST（重置连接）：用于强制中断连接。
    - 如果收到RST=1的报文，说明与主机的连接出现了严重错误（如主机崩溃），必须释放连接，然后再重新建立连接。或者说明上次发送给主机的数据有问题，主机拒绝响应，带RST标志的TCP报文段称为复位报文段

  - SYN（发起连接）：用于建立连接。
    - 在建立连接时使用，用来同步序号。当SYN=1，ACK=0时，表示这是一个请求建立连接的报文段；当SYN=1，ACK=1时，表示对方同意建立连接。SYN=1，说明这是一个请求建立连接或同意建立连接的报文。只有在前两次握手中SYN才置为1，带SYN标志的TCP报文段称为同步报文段

  - FIN（结束连接）：用于关闭连接。
    - 表示通知对方本端要关闭连接了，标记数据是否发送完毕。如果FIN=1，即告诉对方：“我的数据已经发送完毕，你可以释放连接了”，带FIN标志的TCP报文段称为结束报文段



### 窗口大小

- Window Size

- 指定接收方的窗口大小，表示发送方可以发送的未确认数据的最大数量。
- 表示现在允许对方发送的数据量



### 校验和

- Checksum
- 提供额外的可靠性
- 校验和字段用于检测TCP报文段在传输过程中是否发生了错误或损坏。它是通过对TCP头部和数据部分进行计算得到的一个值。发送方在发送数据之前计算校验和，并将其包含在TCP包头中。接收方在接收到数据后，也会计算校验和，并与接收到的校验和进行比较，以检测数据是否完整和正确。
- TCP的校验和是通过对16位字（2字节）进行逐个二进制反码求和得到的。发送方计算校验和时，将TCP头部和数据部分作为校验对象，将每个16位字相加，如果有溢出，则将其回卷到低位，并将结果取反。接收方在接收到数据后，也按照同样的方法计算校验和，并与接收到的校验和进行比较。如果两者一致，表示数据没有被修改或损坏；如果不一致，则表示数据可能发生了错误或损坏。
- 校验和的作用是确保数据的完整性和可靠性。在TCP协议中，数据可能经过多个网络节点传输，而在传输过程中可能发生位错误、噪声或其他损坏。通过校验和，TCP可以检测出这些错误或损坏，并丢弃被篡改的数据，从而保证数据的可靠性。
- 注意，校验和只能检测数据的完整性，而不能纠正错误。如果校验和不匹配，接收方会丢弃数据，并通知发送方重新发送。发送方也可以在收到重传请求时重新发送数据。因此，校验和是TCP协议中的一个重要机制，用于提供数据的可靠传输。



### 紧急指针

- Urgent Pointer
- 标记紧急数据在数据字段中的位置

- 仅当URG标志位设置为1时，紧急指针字段才有效。它指示紧急数据在TCP流中的位置。



### 选项

- Options

- TCP头部中可以包含一些可选的选项字段，用于扩展TCP的功能或进行特定的配置。例如，最常见的选项之一是窗口扩大因子（Window Scale Option），用于在高延迟网络中扩大窗口大小。
- 选项（长度可变），其最大长度可根据TCP首部长度进行推算。TCP首部长度用4位表示，选项部分最长为：(2^4-1)*4-20=40字节



### 数据

- Payload

- TCP头部后面是数据部分，也称为负载，它包含应用程序要传输的实际数据。数据部分的长度可以是零或更多字节。



### Wireshark 抓 TCP 包



## TCP 三次握手过程

![tcp三次握手](images\tcp三次握手.png)

- **第一次握手：**客户端向服务器发送SYN=1的标记位包 和seq=x的序列号包 然后服务器进入LISTEN状态
- **第二次握手：**服务器向客户端发送SYN=1和ACK=1的标记位包，以及seq=y和ack=x+1的包（ack=x+1是服务器为了表示已经收到了这个包请给我发下一个包所以ack=x+1）然后客户端进入SYN-SEND状态
- **第三次握手：**客户端向服务器发送ACK=1的标记位包，以及seq=x+1和ack=y+1的包 然后服务器进入SYN-RCVD状态，最后双方都进入ESTAB-LISHED状态 从而建立了可靠连接 开始互相发送数据

### GPT

TCP的三次握手（Three-Way Handshake）是建立TCP连接的过程，用于确保通信双方都愿意建立连接并进行数据传输。下面是对TCP三次握手的详细解释：

1. 第一次握手（SYN）：
   - 客户端（发送方）向服务器（接收方）发送一个特殊的TCP报文段，称为SYN报文段。
   - 客户端将自己的初始序列号（ISN）放入报文段的序列号字段，并设置SYN标志位为1。
   - 这表示客户端请求建立连接，并指定自己的初始序列号。
2. 第二次握手（SYN+ACK）：
   - 服务器收到客户端的SYN报文段后，如果同意建立连接，会发送一个带有确认和SYN标志位的报文段，称为SYN+ACK报文段。
   - 服务器将确认号设置为客户端的初始序列号加1，将自己的初始序列号放入序列号字段，并设置SYN和ACK标志位为1。
   - 这表示服务器接受客户端的请求，并指定自己的初始序列号。
3. 第三次握手（ACK）：
   - 客户端收到服务器的SYN+ACK报文段后，会向服务器发送一个确认报文段，称为ACK报文段。
   - 客户端将确认号设置为服务器的初始序列号加1，将序列号设置为自己的初始序列号加1，并设置ACK标志位为1。
   - 这表示客户端确认服务器的响应，并告知服务器自己准备好进行数据传输。

完成了这三次握手后，TCP连接就建立起来了，双方可以开始进行数据的传输。此时，客户端和服务器都知道彼此已准备好接收数据，并且双方已经确认了彼此的初始序列号。

TCP三次握手的目的是确保双方都愿意建立连接，并同步双方的初始序列号。通过这个过程，可以验证通信双方的可达性和可靠性，并确保后续的数据传输可以可靠地进行。同时，三次握手还可以防止已经失效的连接请求导致的资源浪费和网络拥塞。

需要注意的是，三次握手是TCP连接建立的最小必要步骤，但在实际通信中可能会有更多的步骤和交互，如选项交换和参数协商等。这些步骤可以在握手过程中或之后进行，以满足具体应用需求和协议要求。



**TCP三次握手为什么不是两次握手？**

- 因为两次握手只能使单方的连接状态得到确认，而四次或更高次的握手没有必要，所以三次握手是最合理的过程

TCP采用三次握手的设计是为了确保连接的可靠性和正确性。以下是为什么不是两次握手的解释：

1. 确定双方的初始序列号：在TCP连接建立时，双方需要交换彼此的初始序列号（Initial Sequence Number，ISN）。通过三次握手，客户端和服务器都能够发送自己的ISN，并确认对方的ISN。这样可以防止旧的连接请求导致的资源浪费和数据混淆。
2. 确认连接双方的可达性：两次握手无法提供足够的保证来验证连接双方的可达性。在两次握手的情况下，客户端发送连接请求后，服务器可以接受连接并发送确认，但客户端无法获知服务器是否成功接收确认。如果客户端没有收到确认，它将不知道是否连接已经建立，从而无法正确处理后续的数据传输。
3. 防止已失效的连接请求：在网络中，可能会存在延迟、重复或乱序的数据包。如果采用两次握手，客户端发送连接请求后，由于网络延迟或其他原因，该请求可能会长时间滞留在网络中。如果服务器在此期间启动并向客户端发送连接确认，客户端可能会接收到失效的连接确认，导致建立了一个无效的连接。

通过三次握手，可以确保双方都愿意建立连接，并能够正确地交换初始序列号和确认信息。这样可以避免上述问题，并提供更可靠和稳定的连接建立过程。虽然三次握手会增加一定的延迟和网络负载，但它是保证连接可靠性和正确性的重要步骤。





## TCP 四次挥手过程

![tcp四次挥手](images\tcp四次挥手.png)



TCP的四次挥手（Four-Way Handshake）是用于关闭TCP连接的过程。在TCP连接中，当通信双方完成数据传输后，需要经过四次挥手来正确地关闭连接。下面是对TCP四次挥手的详细解释：

1. 第一次挥手（FIN）：
   - 当一方（通常是客户端）决定关闭连接时，它会发送一个带有FIN标志位的报文段，称为FIN报文段。
   - FIN标志位表示该方已经完成了数据的发送，不再有数据需要发送。
2. 第二次挥手（ACK）：
   - 另一方（通常是服务器）收到FIN报文段后，会发送一个确认报文段，即带有ACK标志位的报文段，作为对收到的FIN报文段的确认。
   - 这个ACK报文段不会立即关闭连接，它只是告知对方已经收到了关闭请求。
3. 第三次挥手（FIN）：
   - 在收到确认的一方（通常是服务器）完成自己的数据发送后，也会发送一个带有FIN标志位的报文段，表示它已经完成了数据的发送，准备关闭连接。
4. 第四次挥手（ACK）：
   - 另一方（通常是客户端）收到FIN报文段后，发送一个确认报文段，即带有ACK标志位的报文段，作为对收到的FIN报文段的确认。
   - 这个ACK报文段通常是在等待一段时间后发送，以确保对方的FIN报文段能够被正确接收。

完成了这四次挥手后，TCP连接就正式关闭了。双方都知道彼此已完成数据传输并准备关闭连接。这样可以保证数据的完整性和可靠性，确保双方都不会在关闭之前丢失数据。

需要注意的是，四次挥手是TCP连接关闭的最小必要步骤，但在实际通信中可能会有更多的步骤和交互，如数据确认和超时处理等。这些步骤可以在挥手过程中或之后进行，以满足具体应用需求和协议要求。



## TCP有限状态机

TCP协议定义了一共有11种有限状态机（Finite State Machine），用于描述TCP连接在不同阶段的状态和状态转换。以下是TCP的11种有限状态机：

1. LISTEN：服务器处于等待连接请求的状态。
2. SYN-SENT：客户端发送了连接请求，并等待服务器的确认。
3. SYN-RECEIVED：服务器接收到客户端的连接请求，并发送确认请求。
4. ESTABLISHED：连接已建立，双方可以进行数据传输。
5. FIN-WAIT-1：客户端关闭连接，等待服务器的确认。
6. FIN-WAIT-2：服务器收到客户端的关闭请求，并发送确认。
7. CLOSE-WAIT：服务器关闭连接，等待客户端的关闭请求。
8. CLOSING：同时发起关闭请求，等待对方的确认。
9. LAST-ACK：服务器收到客户端的关闭请求，并发送确认。
10. TIME-WAIT：连接关闭后的等待状态，确保所有分组都已从网络中消失。
11. CLOSED：连接已完全关闭。

这些状态机描述了TCP连接在不同阶段的行为和状态转换。TCP的状态机模型使得连接的建立、数据传输和关闭过程能够按照一定的规则进行，保证了可靠性和正确性。不同的状态机允许连接在不同的阶段进行特定的操作和响应，以适应不同的场景和需求。



### 状态机分类

- 握手和挥手共有的状态：
  - CLOSED 没有任何连接状态
  - ESTABLISHED 代表传输连接建立，双方进入数据传送状态

- 三次握手独有的状态：
  - LISTEN 侦听状态，等待来自远方TCP端口的连接请求
  - SYN-SENT 在发送连接请求后，等待对方确认
  - SYN-RECEIVED 在收到和发送一个连接请求后，等待对方确认

- 四次挥手独有的状态：
  - FIN-WAIT-1 主动关闭,主机已发送关闭连接请求，等待对方确认
  - FIN-WAIT-2 主动关闭,主机已收到对方关闭传输连接确认，等待对方发送关闭传输连接请求
  - TIME-WAIT 完成双向传输连接关闭，等待所有分组消失
  - CLOSE-WAIT 被动关闭,收到对方发来的关闭连接请求，并已确认
  - LAST-ACK 被动关闭,等待最后一个关闭传输连接确认，并等待所有分组消失
  - CLOSING 双方同时尝试关闭传输连接，等待对方确认





# UDP

UDP（User Datagram Protocol）是一种面向无连接的传输层协议，它提供了一种简单的数据传输机制，适用于快速传输和实时性要求较高的应用。

下面是对UDP的详细解释：

1. 无连接性：UDP是一种无连接的协议，这意味着在数据传输之前，发送方和接收方之间不需要建立持久的连接。每个UDP数据包都是独立的，它们可以独立地从发送方发送到接收方。
2. 面向报文：UDP将应用程序发送的数据划分为数据报文（Datagram），并在网络上传输。每个UDP数据报文都有自己的首部，包含源端口和目标端口等信息，用于标识应用程序之间的通信。
3. 不可靠性：UDP不提供数据包的可靠传输。它没有确认、重传和流量控制等机制。如果数据包在传输过程中丢失或损坏，UDP不会重新发送或修复它们，而是直接将数据传递给应用程序，由应用程序自行处理丢失或损坏的数据。
4. 高效性和低延迟：由于UDP不需要建立连接和维护状态等额外开销，它比TCP更加轻量级，具有更低的传输延迟和更高的传输效率。这使得UDP适用于实时音视频传输、游戏和实时通信等对实时性要求较高的应用场景。
5. 支持多播和广播：UDP可以通过使用特定的IP地址范围来支持多播和广播传输。多播允许将数据同时传输给一组特定的接收方，而广播允许将数据传输给网络中的所有主机。

UDP在许多应用中得到广泛应用，特别是在那些对数据传输的实时性和效率要求较高的场景。然而，由于其不可靠性，应用程序需要自行处理数据的丢失、重复和顺序问题。如果应用程序需要可靠的传输保证，TCP可能更适合使用。



## UDP 特性

以下是对UDP特性的解释：

1. **工作在传输层**： UDP（User Datagram Protocol）是一种传输层协议，用于在网络上传输数据。它提供了一种将数据从源主机发送到目标主机的机制。
2. **提供不可靠的网络访问**： UDP是一种不可靠的协议，它不提供数据传输的可靠性保证。它将数据报发送到目标主机，但无法保证数据报能够到达目标主机，也无法保证数据报的顺序。
3. **非面向连接协议**： UDP是一种非面向连接的协议，它在发送数据之前不需要建立连接。每个UDP数据报都是独立的，独立地处理和传输，不需要在发送和接收之间维护连接状态。
4. **有限的错误检查**： UDP提供了有限的错误检查机制。它包含一个简单的校验和字段，用于检测数据在传输过程中是否发生了错误，但它无法提供数据的完整性和准确性。
5. **传输性能高**： UDP在传输性能方面较为优秀。由于它没有连接建立和保持的开销，并且没有拥塞控制和流量控制等机制，因此它具有较低的传输延迟和较高的传输速率。
6. **无数据恢复特性**： UDP不具备数据恢复的特性。如果在传输过程中发生数据丢失或错误，UDP无法自动重传或纠正，而是丢弃或传递错误的数据。

总的来说，UDP是一种简单的传输协议，适用于一些对实时性要求高、数据完整性要求相对较低的应用场景，如音频、视频流传输、实时游戏等。它具有快速传输、低延迟的特点，但缺少了可靠性和数据恢复的机制。



## UDP 包头结构

![udp包头结构](images\udp包头结构.png)

1. 源端口号（Source Port）： 占用16位，指定发送端口号。它标识了发送UDP数据报的应用程序或服务的端口号。
2. 目标端口号（Destination Port）： 占用16位，指定接收端口号。它标识了接收UDP数据报的应用程序或服务的端口号。
3. 长度（Length）： 占用16位，表示UDP数据报的长度，包括UDP头部和数据部分。长度字段的最小值为8字节（UDP头部的大小），最大值为65,535字节。
4. 校验和（Checksum）： 占用16位，用于对UDP头部和数据进行校验。校验和字段可以检测数据在传输过程中是否发生了错误或被篡改，但它并不能进行错误的纠正。
5. 数据（Payload）（可选）： 可选字段，用于携带上层协议的数据。它可以是应用程序发送的任意数据，长度取决于长度字段的值。

UDP包头相对简单，只包含了必要的字段来标识源端口、目标端口、长度和校验和。相比于TCP，UDP不需要连接建立和维护等额外的控制信息，因此头部较为简洁，适用于实时性要求高、数据完整性要求相对较低的应用场景。



# TCP 与 UDP 对比

TCP（传输控制协议）和UDP（用户数据报协议）是互联网协议套件中两种不同的传输协议。它们在数据传输方式、可靠性和适用场景等方面存在差异。

1. **连接性：**
   - TCP是面向连接的协议，通过建立一个可靠的连接来传输数据。在通信之前，必须先建立连接，然后进行数据传输，最后再关闭连接。
   - UDP是面向无连接的协议，数据包可以直接发送到目标地址，而无需事先建立连接。
2. **可靠性：**
   - TCP提供可靠的数据传输，通过使用确认、重传和流量控制等机制来确保数据的可靠性。它保证数据按顺序到达目标地址，并且可以检测和纠正丢失或损坏的数据。
   - UDP不提供可靠性保证。它发送数据包后不会对其进行确认或重传。因此，数据包可能会丢失、重复或乱序到达目标地址。
3. **速度和效率：**
   - UDP比TCP更轻量级，没有TCP的连接建立和维护开销。因此，UDP具有较低的延迟和更高的传输速度。
   - TCP的可靠性机制会引入一些额外的开销，例如确认和重传，可能会导致一定的延迟，并且在网络负载较重时，传输速度可能会下降。
4. **适用场景：**
   - TCP适用于对数据可靠性要求较高的应用，如文件传输、电子邮件、Web浏览等。它确保数据的完整性和顺序性。
   - UDP适用于对实时性要求较高，但数据可靠性要求较低的应用，如音频/视频流传输、在线游戏等。它提供了较低的延迟和更高的传输速度，但无法保证数据的可靠性。

总结来说，TCP适合对数据可靠性有较高要求的场景，而UDP适合对实时性要求较高，但对数据可靠性要求较低的场景。选择使用哪种协议取决于应用程序对数据传输的要求和特定的使用场景。





# 套接字 Socket

套接字（Socket）是在网络编程中使用的一种抽象概念，用于进行网络通信。套接字提供了一种编程接口，使应用程序能够通过网络发送和接收数据。

**套接字通常由以下几个要素组成：**

1. IP地址：指定网络中的主机地址，可以是IPv4地址（如192.168.0.1）或IPv6地址（如2001:0db8:85a3:0000:0000:8a2e:0370:7334）。
2. 端口号：用于标识应用程序在主机上运行的网络服务。端口号是一个16位的整数，范围从0到65535。其中，0到1023的端口号被保留用于众所周知的服务（例如，HTTP使用的端口号是80）。
3. 传输协议：指定了数据在网络中的传输方式。常用的传输协议有TCP（传输控制协议）和UDP（用户数据报协议）。TCP提供面向连接的、可靠的数据传输，而UDP是一种无连接的、不可靠的数据传输协议。

**套接字的工作原理如下：**

1. 创建套接字：在应用程序中使用套接字编程接口创建一个套接字对象。
2. 绑定地址和端口：将套接字与指定的IP地址和端口号绑定。这样，套接字就可以监听该地址和端口上的连接请求。
3. 监听连接请求（仅适用于TCP）：对于使用TCP协议的套接字，可以通过调用监听函数来监听指定地址和端口上的连接请求。这样，套接字可以接受传入的连接请求。
4. 接受连接请求（仅适用于TCP）：当套接字监听到传入的连接请求后，可以通过调用接受函数来接受连接。这将创建一个新的套接字对象，用于与客户端进行通信。
5. 发送和接收数据：通过套接字对象可以使用发送和接收函数来进行数据的发送和接收。对于TCP套接字，数据将按顺序、可靠地传输；对于UDP套接字，数据将以数据报的形式进行传输，不保证顺序和可靠性。
6. 关闭套接字：当通信完成时，可以调用关闭函数来关闭套接字，释放相关的资源。

套接字编程提供了一种灵活、可扩展的方式来进行网络通信。通过套接字，应用程序可以在不同主机之间进行数据传输，实现各种网络应用，如Web服务、邮件传输、文件传输等。





# 其它传输层协议

除了TCP和UDP之外，还有以下工作在传输层的协议：

1. SCTP（Stream Control Transmission Protocol）：SCTP是一种面向消息的传输层协议，旨在提供可靠性和传输效率。它支持多个流的并行传输，并提供拥塞控制和错误检测等功能。SCTP通常用于多路径传输和对可靠性有较高要求的应用，如VoIP和实时流媒体。
2. DCCP（Datagram Congestion Control Protocol）：DCCP是一种基于UDP的传输层协议，提供了可靠性和拥塞控制机制。它在传输效率和可靠性之间提供了一种折衷方案，适用于实时应用和流媒体传输。
3. RSVP（Resource Reservation Protocol）：RSVP是一种用于建立服务质量（Quality of Service，QoS）的传输层协议。它允许网络中的主机请求特定的服务质量保证，并协商网络设备在传输过程中的行为。
