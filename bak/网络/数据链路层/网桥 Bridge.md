# 网桥概述

- 网桥，顾名思义，网络连接的桥梁，将多台设备串联在一起，**其功能类似于交换机**

- 网桥和交换机一样，都无需IP地址，但一般为了便于管理而配置IP

- **桥接原理：**

  把一台机器上的若干个网络接口“连接”起来。其结果是，其中一个网口收到的报文会被复制给其他网口并发送出去。以使得网口之间的报文能够互相转发。网桥就是这样一个设备，它有若干个网口，并且这些网口是桥接起来的。与网桥相连的主机就能通过交换机的报文转发而互相通信。



网桥是数据链路层的概念。在OSI模型中，数据链路层是第二层，负责在相邻节点之间传输数据帧。

网桥是一种网络设备，用于连接多个局域网（LAN）或网络段，并将它们视为单个网络。网桥的主要功能是根据目标MAC地址将数据帧从一个网络段转发到另一个网络段。它通过学习和维护MAC地址表，了解哪个MAC地址位于哪个网络段，并根据需要转发数据。

网桥工作在数据链路层，它基于MAC地址对数据进行转发决策，而不涉及IP地址或其他网络层协议。网桥通过监视和分析数据帧的目标MAC地址，决定将数据帧转发到目标网络段，从而实现网络的连接和通信。

值得注意的是，现代网络中的交换机通常具有网桥功能，并在更高的速度和更复杂的方式上执行相同的数据链路层转发功能。因此，尽管网桥是数据链路层的概念，但在实际网络中，交换机起到了类似的作用，并扩展了网桥的功能。



网桥是计算机网络中用于连接两个局域网（LAN）的设备。它是一种网络设备，能够将数据包从一个局域网转发到另一个局域网。网桥工作在OSI模型的第二层，即数据链路层，根据目标MAC地址来转发数据。

以下是一些关于网桥的详细解释：

1. 功能：网桥的主要功能是连接两个或多个局域网，以便它们可以相互通信。网桥通过学习每个端口上的设备的MAC地址，并维护一个转发表，将数据包转发到目标MAC地址所在的端口上。这样，它可以实现局域网之间的无阻塞数据传输。
2. MAC地址学习：网桥会监听每个接口收到的数据包，并记录发送数据包的设备的MAC地址及其所在的接口。这样，网桥就能够学习到哪个MAC地址可以通过哪个接口访问。
3. 转发决策：当网桥收到一个数据包时，它会检查数据包中的目标MAC地址，并查找转发表，以确定应该将数据包转发到哪个接口。如果转发表中存在目标MAC地址的条目，则数据包将被转发到相应的接口。如果转发表中不存在目标MAC地址的条目，则数据包将被转发到除接收端口之外的所有接口，以便扩散到其他局域网中，从而允许学习新的MAC地址。
4. 透明性：网桥是透明的，它不会更改数据包的内容或地址。它只是根据目标MAC地址将数据包从一个接口转发到另一个接口。
5. 过滤和隔离：网桥可以通过过滤某些数据包来实现网络隔离。例如，如果一个网桥连接了一个企业的内部网络和公共互联网，它可以配置为仅允许某些类型的数据包通过，从而提高安全性。
6. 碰撞域划分：通过连接不同的局域网，网桥可以划分网络中的碰撞域。碰撞域是指在以太网中发生碰撞的区域。网桥可以减少碰撞域的大小，从而提高网络的性能和可靠性。

需要注意的是，现代网络中，网桥的功能已经被交换机（Switch）所取代。交换机是网桥的升级版，它具有更高的性能和更多的功能。然而，理解网桥的原理和工作方式对于理解网络基础知识仍然很重要。



## 交换机与网桥的区别

交换机（Switch）和网桥（Bridge）在功能和性能上有一些区别，尽管它们的基本原理相似。以下是交换机与网桥之间的几个主要区别：

1. 端口数量和扩展性：交换机通常具有更多的端口，可以同时连接多个设备。一般而言，网桥通常只有几个端口。交换机还支持更大的扩展性，可以通过堆叠、链路聚合等方式扩展端口数量。
2. 转发速度和性能：交换机通常具有更高的转发速度和更低的延迟，因为它们内部使用专用的交换芯片进行转发决策和数据包转发。这使得交换机在处理大量数据流量时更加高效，而网桥可能会受到性能限制。
3. 转发决策方式：交换机使用基于硬件的MAC地址转发表进行数据包转发决策，速度更快。而网桥使用基于软件的MAC地址学习和转发表。交换机的硬件转发表可以处理更大的MAC地址表和更复杂的网络拓扑。
4. VLAN支持：交换机通常支持虚拟局域网（VLAN）的功能，可以将一个物理交换机划分为多个逻辑上隔离的虚拟网络。这样可以增强网络的灵活性和安全性。网桥通常不支持VLAN功能。
5. 附加功能：交换机通常具有许多附加功能，如端口镜像、流量控制、链路聚合、QoS（Quality of Service）等。这些功能提供了更多的网络管理和优化选项。网桥通常不具备这些高级功能。

综上所述，交换机是网桥的升级版本，提供了更多的端口、更高的性能和额外的功能。对于现代网络，交换机是更常见和广泛使用的设备，而网桥主要在特定的应用场景下或较小规模的网络中使用。



## 交换机与网桥的共同点

交换机（Switch）和网桥（Bridge）有以下共同点：

1. 转发机制：交换机和网桥都使用MAC地址学习和转发表的机制来转发数据包。它们都会监听网络上的数据包，学习发送数据包的设备的MAC地址，并根据目标MAC地址来转发数据包。
2. 局域网连接：交换机和网桥都用于连接局域网（LAN），使得不同局域网之间的设备可以相互通信。它们在物理层或数据链路层上实现局域网的扩展和连接。
3. 数据包转发：交换机和网桥都能够根据目标MAC地址将数据包转发到正确的接口。它们都具备将数据包从一个接口转发到另一个接口的功能，以实现设备之间的通信。
4. 透明性：交换机和网桥都是透明的，它们不会更改数据包的内容或地址。它们只是根据目标MAC地址将数据包从一个接口转发到另一个接口。

尽管交换机和网桥在性能、功能和扩展性上存在一些区别，但它们的基本原理和目标是相似的。它们都起到了将局域网连接在一起的作用，并提供了数据包转发的功能。



## 网桥工作在哪一层

网桥（Bridge）工作在OSI模型的第二层，即数据链路层。数据链路层是OSI模型中的第二层，位于物理层之上和网络层之下。它负责将物理层提供的原始比特流组织成帧（Frame），并在本地网络内传输数据帧。

网桥在数据链路层上工作，根据目标MAC地址来转发数据包。它监听网络上的数据包，学习发送数据包的设备的MAC地址，并根据目标MAC地址将数据包转发到正确的接口。网桥利用MAC地址学习和转发表来决定数据包的转发路径，以实现不同局域网之间的通信。

值得注意的是，OSI模型的第二层还包括了交换机（Switch）这样的设备。交换机可以看作是一种多接口的高级网桥，它在数据链路层上工作，使用硬件转发表进行数据包的高速转发和交换。因此，交换机也属于数据链路层的设备。







# Bridge 管理相关工具

## brctl

- 查看网桥情况
- 来自bridge-utils包，目前 CentOS 8 无此包

```bash
#查看是否为网桥
brctl show

#查看CAM(content addressable memory内容可寻址存储器)表 
brctl showmacs br0

#添加和删除网桥 
brctl <addbr | delbr> br0 

#添加和删除网桥中网卡 
brctl <addif | delif> br0 eth0

#启用网桥，（默认网桥br0 是down的）
ifconfig br0 up

#将网卡eth0加入到网桥br0中
brctl addif br0 eth0

#启用STP
# brctl show
bridge name	bridge id		STP enabled	interfaces
br0		8000.000000000000	no		
# brctl stp br0 on
# brctl show
bridge name	bridge id		STP enabled	interfaces
br0		8000.000000000000	yes	
```



brctl（Bridge Control）是一个用于管理Linux操作系统中以太网桥（Ethernet Bridge）的命令行工具。它允许管理员配置和管理网桥，包括创建、删除和修改网桥的属性。以下是brctl命令的常见用法和选项的详解：

1. 创建网桥：可以使用以下命令创建一个新的网桥：

   ```
   brctl addbr <bridge_name>
   ```

   其中，`<bridge_name>`是要创建的网桥的名称。

2. 删除网桥：使用以下命令可以删除一个现有的网桥：

   ```
   brctl delbr <bridge_name>
   ```

   其中，`<bridge_name>`是要删除的网桥的名称。

3. 添加接口：可以使用以下命令将一个物理或虚拟接口（如虚拟机的虚拟接口）添加到网桥中：

   ```
   brctl addif <bridge_name> <interface_name>
   ```

   其中，`<bridge_name>`是要添加接口的网桥的名称，`<interface_name>`是要添加的接口的名称。

4. 删除接口：使用以下命令可以从网桥中删除一个接口：

   ```
   brctl delif <bridge_name> <interface_name>
   ```

   其中，`<bridge_name>`是要删除接口的网桥的名称，`<interface_name>`是要删除的接口的名称。

5. 显示网桥信息：可以使用以下命令查看当前系统中存在的网桥及其相关信息：

   ```
   brctl show
   ```

6. 设置网桥属性：可以使用以下命令设置网桥的属性，如STP（Spanning Tree Protocol）开关和优先级：

   ```
   brctl stp <bridge_name> <on|off>
   brctl setbridgeprio <bridge_name> <priority>
   ```

   其中，`<bridge_name>`是要设置属性的网桥的名称，`<on|off>`用于开启或关闭STP，`<priority>`是设置网桥的优先级。

需要注意的是，使用brctl命令需要具有root权限或使用sudo命令。此外，brctl命令在较新的Linux发行版中已经被ip命令替代，因此在一些系统中可能不再推荐使用brctl命令。



### brctl 输出说明

当运行`brctl show`命令时，它将显示当前系统中存在的网桥及其相关信息。以下是brctl show输出中各列的说明：

```
bridge name    bridge id            STP enabled    interfaces
```

- **bridge name**: 这一列显示了网桥的名称。每个网桥都有一个唯一的名称，由管理员在创建网桥时指定。
- **bridge id**: 这一列显示了网桥的唯一标识符，通常使用MAC地址来表示。网桥的标识符是在创建网桥时自动生成的。
- **STP enabled**: 这一列显示了STP（Spanning Tree Protocol）的状态。如果STP被启用，将显示"yes"；如果STP被禁用，将显示"no"。STP用于防止环路并提供冗余路径的冗余连接协议。
- **interfaces**: 这一列显示了连接到网桥的接口列表。它列出了所有已经添加到网桥中的物理或虚拟接口的名称。如果网桥没有连接任何接口，则此列将为空。

每一行对应一个网桥的信息。可以通过查看不同行中的数据来了解系统中存在的网桥及其配置情况。

需要注意的是，brctl show命令只能显示通过brctl命令创建的网桥。如果系统中使用了其他方式（如使用ip命令）创建的网桥，则可能无法在brctl show输出中看到它们。





## nmcli

- 通用的网络管理工具，可以管理网桥
- 注意：NetworkManager只支持以太网接口接口连接到网桥，不支持聚合接口
- **仅限于CentOS主机**

```bash
#创建网桥
nmcli con add con-name mybr0 type bridge ifname br0 #？？？
nmcli con modify mybr0 ipv4.addresses 192.168.0.100/24 ipv4.method manual #？？
nmcli con add con-name br0-port0 type bridge-slave ifname eth0 master br0 #？？
```







# Bridge 实验

## 环境

- 网桥设备无需IP，但便于管理通常配置IP

<img src="images\网桥实验.png" alt="网桥实验" style="zoom:50%;" />

- 故障排错：未生效的话可以检查eth系列网卡是否处于DOWN状态

```bash
# 未添加 bridge 前 10.0.0.100 和 10.0.0.101 是 ping 不通的，因为双方都连接在不同的交换机上

# 添加br0网桥
brctl addbr br0

# 默认br0是down，启用br0
ifconfig br0 up

# 将两块网卡加入到网桥中
brctl addif br0 eth0
brctl addif br0 eth1

# 最终状态
# brctl show
bridge name	bridge id		STP enabled	interfaces
br0		8000.000c2906ce34	no	     	eth0
							            eth1

# 测试访问
# ping -I 10.0.0.100 10.0.0.101
PING 10.0.0.101 (10.0.0.101) from 10.0.0.100 : 56(84) bytes of data.
64 bytes from 10.0.0.101: icmp_seq=1 ttl=64 time=1.01 ms
...

# 其他信息
# brctl showmacs br0 
port no	mac addr		is local?	ageing timer
  1	00:0c:29:06:ce:34	yes		      0.00 # 本地eth0的mac
  1	00:0c:29:06:ce:34	yes		      0.00
  2	00:0c:29:06:ce:3e	yes		      0.00 # 本地eth1的mac
  2	00:0c:29:06:ce:3e	yes		      0.00
  2	00:0c:29:0d:63:cd	no		      0.12 # 10.0.0.101的mac
  1	00:0c:29:cd:b5:7f	no		      0.08 # 10.0.0.100的mac
```




