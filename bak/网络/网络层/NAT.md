# 前言

NAT（Network Address Translation）是网络层的概念。

在OSI模型中，网络层是第三层，负责在网络之间传输数据包。NAT是一种在网络层上进行的地址转换技术，主要用于将私有IP地址转换为公共IP地址，以实现局域网内部与公共网络（如互联网）之间的通信。

NAT工作在网络层，它在IP数据包的源地址和目标地址之间进行转换。当内部网络中的主机发送数据包到外部网络时，NAT会将源IP地址替换为公共IP地址。当外部网络返回数据包时，NAT会根据先前建立的映射信息将目标IP地址还原为内部主机的私有IP地址。

NAT主要有以下几种形式：

1. 静态NAT（Static NAT）：将一个私有IP地址映射到一个公共IP地址，一对一的映射关系。
2. 动态NAT（Dynamic NAT）：将一组私有IP地址映射到一个或多个公共IP地址，根据需求进行动态映射。
3. NAT Overload（或称为PAT，Port Address Translation）：通过使用端口号来区分不同的内部主机，将多个私有IP地址映射到单个公共IP地址。

总之，NAT是一种在网络层上进行的地址转换技术，用于解决IP地址短缺和保护内部网络的安全性。它将私有IP地址转换为公共IP地址，从而使得内部网络能够与公共网络进行通信。



**NAT是网络层的协议吗？**

NAT（Network Address Translation）并不是一个网络层的协议，而是一种网络技术或功能。它通常用于互联网接入路由器或防火墙设备中，用于将一个私有网络的IP地址映射到公共网络的IP地址。

NAT的主要目的是解决IPv4地址短缺的问题。在IPv4中，IP地址的分配非常有限，而NAT技术允许多个设备共享单个公共IP地址。当内部设备尝试访问互联网时，NAT设备会将其内部私有IP地址转换为公共IP地址，并在返回的数据包中进行相应的逆转换。

虽然NAT通常在网络层的路由器或防火墙设备上实现，但它本身并不是一个网络层的协议。网络层的协议通常包括IP协议（如IPv4或IPv6）、ICMP协议等。NAT是一种在网络层上运行的技术，用于地址转换和网络连接的管理。



# NAT 概述

NAT（Network Address Translation，网络地址转换）是一种在计算机网络中常用的技术，它通过将私有网络地址（如在局域网中使用的IP地址）转换为公网可路由的地址，来解决IP地址不足的问题。

NAT通常在路由器或防火墙上实现，它可以将内部网络中的多个计算机共享一个公网IP地址。当内部计算机需要访问公网时，路由器会将其源IP地址转换为公网IP地址并将请求发送到Internet上的目标服务器，同时将目标服务器的响应再转换回源IP地址，最终返回给内部计算机。



**NAT 优点**

- NAT技术可以提高内部网络的安全性，因为通过NAT转换后的内部IP地址不会直接暴露在公网上，从而减少了被攻击的风险。
- 但是，NAT也可能会对一些应用程序造成影响，例如需要通过IP地址识别客户端的应用程序可能无法正常工作，需要通过NAT穿透技术才能解决。



**SNAT & DNAT**

- SNAT（Source NAT，源地址转换）和DNAT（Destination NAT，目标地址转换）都是NAT的实现方式，它们通常被视为NAT的子集。
- SNAT和DNAT可以用于实现静态NAT、动态NAT和PAT。









# 静态 NAT

静态NAT（Static Network Address Translation，静态地址转换）是一种NAT技术，它将内部网络的私有IP地址转换为公网IP地址的一种固定映射关系，与内部计算机的IP地址和端口号无关。静态NAT通常用于将内部网络中的服务器或计算机暴露在公网上，以便公网用户可以通过公网IP地址和端口号访问内部网络中的服务。

静态NAT通常在路由器或防火墙上实现，管理员需要手动配置静态NAT的映射关系。当公网用户发送请求到静态NAT映射的公网IP地址和端口号时，路由器或防火墙会将请求转发到内部网络中的服务器或计算机上。当内部计算机返回响应时，路由器或防火墙会将响应中的源IP地址和端口号转换为静态NAT映射的公网IP地址和端口号，并将响应返回给请求方。

需要注意的是，静态NAT的映射关系是固定的，一旦配置完成后就不会再改变，这意味着只有一个内部计算机可以映射到一个公网IP地址上。如果需要将多个内部计算机映射到同一个公网IP地址上，则需要使用端口映射（Port Forwarding）技术，将不同的端口号映射到不同的内部计算机上。

静态NAT通常用于以下情况：

- 将内部网络中的服务器或计算机暴露在公网上，以便公网用户可以通过公网IP地址和端口号访问内部网络中的服务。
- 防止内部网络中的IP地址冲突，将内部网络的私有IP地址转换为公网IP地址，以便内部计算机可以与公网通信。

需要注意的是，静态NAT可能会导致一些安全风险，例如将内部网络中的服务器或计算机暴露在公网上可能会导致攻击或黑客入侵。因此，在配置静态NAT时需要采取相应的安全措施，例如限制公网请求的来源地址和端口号、使用安全协议等。





# 动态 NAT

动态NAT（Dynamic Network Address Translation，动态地址转换）是一种NAT技术，它将内部网络的私有IP地址动态地映射到公网IP地址上，从而实现内部计算机与公网通信。动态NAT通常在路由器或防火墙上实现，它可以自动分配公网IP地址和端口号，以便内部计算机可以与公网通信。

动态NAT通过一系列算法动态地分配公网IP地址和端口号，从而实现内部计算机与公网的通信。当内部计算机发送数据包时，动态NAT会为该数据包分配一个公网IP地址和端口号，并将数据包发送到公网。当公网返回响应时，动态NAT会将响应中的源IP地址和端口号转换为内部计算机的私有IP地址和端口号，并将响应返回给内部计算机。

需要注意的是，动态NAT的映射关系是动态的，会根据内部计算机的请求情况进行调整。这意味着多个内部计算机可以共享一个公网IP地址，因为动态NAT会为每个内部计算机分配不同的端口号。此外，动态NAT还可以实现IP地址重用，即在一个内部计算机不再需要一个公网IP地址和端口号时，这个公网IP地址和端口号可以被分配给另一个内部计算机使用。

动态NAT通常用于以下情况：

- 内部网络中有大量的计算机需要与公网通信，但公网IP地址不够用的情况下，可以使用动态NAT来实现IP地址的重用和共享。
- 内部网络中的IP地址不足以支持所有计算机的同时通信，可以使用动态NAT来实现IP地址的动态分配和管理。

需要注意的是，动态NAT也可能会导致一些安全风险，例如公网用户可以通过已经分配给另一个内部计算机的公网IP地址和端口号访问内部计算机，因此需要采取相应的安全措施，例如限制公网请求的来源地址和端口号、使用安全协议等。





# PAT

PAT（Port Address Translation，端口地址转换）是一种NAT技术，它是动态NAT的一种变种，通过将内部网络的私有IP地址映射到公网IP地址和不同的端口号上，实现内部计算机与公网通信。PAT常常在路由器或防火墙上实现，它可以将多个内部计算机共享一个公网IP地址，同时也可以避免冲突。

PAT的工作方式如下：当内部计算机发送数据包时，PAT会将该数据包的源IP地址和端口号转换为一个公网IP地址和一个不同的端口号，并将数据包发送到公网。当公网返回响应时，PAT会将响应中的目标IP地址和端口号转换为内部计算机的私有IP地址和端口号，并将响应返回给内部计算机。

需要注意的是，PAT使用不同的端口号来标识不同的内部计算机，因此它也被称为端口多路复用（Port Multiplexing）。PAT的映射关系是动态的，会根据内部计算机的请求情况进行调整。当内部计算机不再需要一个公网IP地址和端口号时，这个公网IP地址和端口号可以被分配给另一个内部计算机使用。

PAT通常用于以下情况：

- 内部网络中有多个计算机需要与公网通信，但公网IP地址不够用的情况下，可以使用PAT来实现IP地址的共享和多路复用。
- 内部网络中的IP地址不足以支持所有计算机的同时通信，可以使用PAT来实现IP地址的动态分配和管理。

需要注意的是，PAT也可能会导致一些安全风险，例如公网用户可以通过已经分配给另一个内部计算机的公网IP地址和端口号访问内部计算机，因此需要采取相应的安全措施，例如限制公网请求的来源地址和端口号、使用安全协议等。





# SNAT

SNAT是将源IP地址和端口号从私有IP地址和端口号转换为公网IP地址和端口号的过程。当内部计算机通过NAT设备访问公网时，NAT设备会将源IP地址和端口号进行转换，以使数据包在公网中传输时能够正确到达目标计算机。SNAT通常用于保护内部网络，隐藏内部网络的真实IP地址，防止攻击者直接访问内部计算机。



SNAT（Source Network Address Translation，源地址转换）是一种NAT技术，它在网络层对数据包的源IP地址进行转换，将内部网络的私有IP地址替换为公网IP地址，从而实现内部网络向公网的通信。SNAT通常在路由器或防火墙上实现。

SNAT的作用是隐藏内部网络的真实IP地址，提高内部网络的安全性。同时，SNAT还可以实现多个内部计算机共享一个公网IP地址的目的。SNAT会记录每个内部计算机的IP地址和端口号，根据这些信息将数据包转发到正确的目的地。当公网服务器返回响应时，SNAT会将响应中的目标IP地址和端口号转换为内部计算机的IP地址和端口号，从而确保响应可以正确返回给发送请求的计算机。

在SNAT中，有两个重要的概念：SNAT地址池和SNAT会话表。

- SNAT地址池：用于存储可用的公网IP地址，当有内部计算机需要向公网发送数据包时，SNAT会从地址池中选择一个IP地址进行转换。
- SNAT会话表：用于记录每个SNAT会话的信息，包括源IP地址、目标IP地址、端口号等。当公网服务器返回响应时，SNAT会根据会话表中的信息将响应转发到正确的内部计算机。

需要注意的是，SNAT可能会导致某些应用程序无法正常工作，例如需要基于IP地址进行身份验证的应用程序。此外，SNAT也可能会导致一些网络故障，例如由于SNAT会话表中的条目过多导致内存不足等问题。因此，在配置SNAT时需要根据实际情况进行权衡和调整。





# DNAT

DNAT是将目标IP地址和端口号从公网IP地址和端口号转换为私有IP地址和端口号的过程。当公网用户访问内部网络时，NAT设备会将目标IP地址和端口号进行转换，以使数据包能够正确到达内部计算机。DNAT通常用于实现服务器的访问，例如Web服务器、FTP服务器等。



DNAT（Destination Network Address Translation，目的地址转换）是一种NAT技术，它在网络层对数据包的目标IP地址进行转换，将公网IP地址替换为内部网络的私有IP地址，从而实现公网向内部网络的通信。DNAT通常在路由器或防火墙上实现。

DNAT的作用是将公网请求转发到内部网络中的服务器或计算机上，从而实现公网对内部网络的访问。DNAT会记录每个外部请求的目标IP地址和端口号，并根据这些信息将请求转发到正确的内部计算机上。当内部计算机返回响应时，DNAT会将响应中的源IP地址和端口号转换为公网的IP地址和端口号，并将响应返回给请求方。

在DNAT中，有两个重要的概念：DNAT地址池和DNAT会话表。

- DNAT地址池：用于存储内部网络中的服务器或计算机的私有IP地址和端口号，当有公网请求到达时，DNAT会从地址池中选择一个IP地址和端口号进行转换。
- DNAT会话表：用于记录每个DNAT会话的信息，包括源IP地址、目标IP地址、端口号等。当内部计算机返回响应时，DNAT会根据会话表中的信息将响应转发到正确的公网请求方。

需要注意的是，DNAT可能会导致一些安全风险，例如将公网请求转发到内部网络中的服务器或计算机上可能会导致攻击或黑客入侵。因此，在配置DNAT时需要采取相应的安全措施，例如限制公网请求的来源地址和端口号、使用安全协议等。

