

# 数据链路层

## ARP

ARP（地址解析协议，Address Resolution Protocol）是用来把**IP地址**转成**MAC地址**的一种协议。MAC地址是设备网卡的物理地址，IP地址是设备在网络中的逻辑地址。因为数据在同一个局域网内传输时，设备需要知道对方的MAC地址才能通信，但一开始它只有对方的IP地址，所以这时候就需要用ARP来做“翻译”。

### 具体过程
假设有两台设备，A和B，它们在同一个局域网里。A知道B的IP地址，但不知道B的MAC地址。A需要通过ARP协议来获取B的MAC地址，然后才能给B发数据包。这个过程可以分为几步：

1. **ARP请求**：
   A**广播**一个ARP请求包到局域网，内容大概是：“我有IP地址X.X.X.X（B的IP地址），谁知道它的MAC地址，快告诉我！”

2. **ARP响应**：
   B收到这个广播请求后，发现自己的IP地址和请求中说的地址匹配，就会通过**单播**的方式回一个ARP响应包，告诉A：“我是X.X.X.X，我的MAC地址是XX:XX:XX:XX:XX:XX。”

3. **缓存**：
   A收到B的响应后，把B的MAC地址和IP地址配对记录在自己的ARP缓存里。以后再需要跟B通信时，A可以直接从缓存中拿出B的MAC地址，就不用再发ARP请求了。

### 什么时候会用ARP协议？
1. 当一台设备想和同一个局域网里的另一台设备通信，但它只知道对方的IP地址时。
2. 如果ARP缓存里的记录过期了（通常几分钟后），设备可能需要再次发送ARP请求来更新MAC地址。

### ARP的几个特点：
- **广播方式**：ARP请求是发给整个局域网的所有设备，大家都会收到，但只有目标设备会响应。
- **ARP缓存**：每台设备都会把查到的MAC地址缓存一段时间，以减少ARP请求的次数。
- **动态更新**：ARP记录会自动更新，比如目标设备的MAC地址改变了，或者记录过期了。

### ARP常见问题：
- **ARP欺骗（攻击）**：黑客可以通过发送伪造的ARP响应包，把自己的MAC地址假冒成目标设备的MAC地址，导致数据包被转发到错误的设备，从而实施攻击。



## STP

- STP，Spanning Tree Protocol，生成树协议
- 是一种工作在OSI网络模型中的第二层([数据链路层](https://baike.baidu.com/item/数据链路层))的通信协议，基本应用是防止交换机冗余链路产生的环路.用于确保以太网中无环路的逻辑拓扑结构.从而避免了[广播风暴](https://baike.baidu.com/item/广播风暴/3574878),大量占用交换机的资源。

- 生产中要启用生成树协议，否则遇到广播风暴时将会引起网络瘫痪
- 生产中为了避免交换机出现单点失败的问题，通常会进行冗余配置，就是多台交换机环路串联起来，当一条线路出现问题时，还有其他链路可以选择，但是这样遇到广播信号时会产生广播风暴，当开启生成树协议后，交换机接口会逻辑上的断开连接从而避免广播风暴，并且会自动检测交换机链路是否畅通，如果发现不畅通，将会自动关闭生成树协议，从而不影响网络的正常访问



## CSMA

载波监听多路访问（Carrier Sense Multiple Access，CSMA）是一种用于共享介质的多点通信协议。CSMA允许多个发送器在同一物理介质上进行通信，同时通过监听载波（信号）来检测是否有其他节点正在发送数据。

CSMA协议的工作原理如下：

1. 载波监听（Carrier Sense）：发送器在发送数据之前会先监听物理介质上是否有其他节点正在发送数据。如果检测到载波（即信号），表示有其他节点正在发送数据，发送器会暂停发送并等待一段时间。
2. 碰撞检测（Collision Detection）：如果发送器在载波监听期间未检测到其他节点的信号，它会继续发送数据。但是，如果发送器在发送过程中检测到与其他节点发送的数据产生碰撞（即发生冲突），它会立即停止发送，并等待一段随机的时间后再次尝试发送。
3. 退避算法（Backoff Algorithm）：当发生碰撞后，发送器会采用一种退避算法，随机选择一个等待时间，然后再次尝试发送数据。这个等待时间可以避免节点之间的再次碰撞，并降低碰撞的概率。

CSMA协议的目标是实现公平的访问共享介质，并避免碰撞。然而，由于物理介质传输的延迟和节点之间的时钟差异，CSMA协议无法完全消除碰撞。因此，在较大的网络中，通常会使用碰撞检测与冲突避免（Collision Detection and Collision Avoidance，CD/CA）的变种，如CSMA/CD协议（用于以太网）和CSMA/CA协议（用于无线网络），以更有效地控制碰撞和访问冲突。



**所属层级：**

CSMA（载波监听多路访问）是一种通信协议，它通常用于数据链路层（Data Link Layer）或物理层（Physical Layer）的协议。在网络通信的分层模型中，数据链路层位于物理层之上，负责将原始的物理位流转化为逻辑上的帧，并提供可靠的数据传输。

CSMA本身并没有明确指定在特定的网络层级中使用，因为它是一种通用的协议机制，可适用于不同层级的网络架构。在实际应用中，CSMA常用于以太网（Ethernet）等局域网技术中的数据链路层。

需要注意的是，CSMA通常与其他协议和技术结合使用，以构建完整的通信系统。例如，在以太网中，CSMA协议通常与以太网帧结构、以太网交换机和其他协议（如ARP、IP等）一起使用，以实现局域网中的数据传输和通信。



### 先听后发

- Carrier Sense

- 在发送数据之前，节点会先监听物理介质上是否有其他节点正在发送数据。通过侦听载波（信号），节点可以检测到其他节点是否正在使用介质进行通信。如果节点检测到有载波存在，表示介质正在被占用，节点将等待一段时间再尝试发送。

### 边发边听

- Collision Detection
- 在节点发送数据时，它也会同时侦听介质上的信号。如果节点在发送数据的同时检测到其他节点的信号，表示发生了碰撞（冲突），即多个节点同时发送数据导致数据损坏。当发生碰撞时，节点立即停止发送，并等待一段随机的时间后再次尝试发送。

### 冲突停止

- Collision Stop
- 当节点检测到碰撞时，它会立即停止发送数据，并执行一种退避算法，以避免连续的冲突发生。退避算法通常会在等待时间的范围内随机选择一个时间段，然后在该时间段之后再次尝试发送数据。这样可以减少节点之间的冲突，并提高数据传输的成功率。

### 延迟重发

- Backoff and Retransmission
- 当节点发生碰撞后，它会等待一段时间（根据退避算法确定），然后重新尝试发送数据。通过引入随机等待时间，节点之间可以避免在同一时间重复尝试发送数据，从而减少冲突的发生。如果在多次尝试后仍然无法成功发送数据，节点可能会执行更复杂的重传机制来确保数据传输的可靠性。

